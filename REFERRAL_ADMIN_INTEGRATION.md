# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å `handlers/admin/referral_info.py` –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

1. **–°–µ–∫—Ü–∏—é –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - `get_referral_section_for_user()`
2. **–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `admin_ref_history`
3. **–†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –¥–µ–Ω–µ–≥** - FSM —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

## üìã –ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –î–æ–±–∞–≤–∏—Ç—å –≤ `handlers/admin/users.py`

–í —Ñ—É–Ω–∫—Ü–∏–∏ `process_update_user_info()` –Ω–∞–π—Ç–∏ –º–µ—Å—Ç–æ –≥–¥–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ç–µ–∫—Å—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –¥–æ–±–∞–≤–∏—Ç—å:

```python
# –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞
from handlers.admin.referral_info import get_referral_section_for_user

# –í —Ñ—É–Ω–∫—Ü–∏–∏ process_update_user_info(), –ø–æ—Å–ª–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:
async with AsyncSessionLocal() as session:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–∫—Ü–∏—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
    ref_text, ref_buttons = await get_referral_section_for_user(session, user.id)
    full_text += ref_text
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º
    keyboard_buttons.extend(ref_buttons)
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É

–£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```python
[InlineKeyboardButton(
    text="ü§ù –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞",
    callback_data=f"admin_ref_history:{telegram_id}"
)]
```

## üéØ –ß—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è:

### –í –∫–∞—Ä—Ç–æ—á–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—è–≤–∏—Ç—Å—è —Å–µ–∫—Ü–∏—è:

```
ü§ù –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –ü–†–û–ì–†–ê–ú–ú–ê 2.0
üí∞ –ë–∞–ª–∞–Ω—Å: 720‚ÇΩ
üìä –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: 1,440‚ÇΩ
üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ: 5 —á–µ–ª.
üí≥ –û–ø–ª–∞—Ç–∏–ª–∏: 2 —á–µ–ª.

üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–±–æ—Ä–æ–≤:
  üí∞ –î–µ–Ω—å–≥–∏: 2 —Ä–∞–∑ (1,440‚ÇΩ)
  üìÖ –î–Ω–∏: 0 —Ä–∞–∑ (0 –¥–Ω.)

[üìä –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π]
[üí∞ –ù–∞—á–∏—Å–ª–∏—Ç—å –¥–µ–Ω—å–≥–∏] <- —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–æ–≤
```

### –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π:

```
üìä –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –í—Å–µ–≤–æ–ª–æ–¥
üì± ID: 44054166

üí∞ 720‚ÇΩ –æ—Ç @test_ref3
   üéØ 20% ¬∑ 23.11.2025 00:30

üìÖ 7 –¥–Ω. –æ—Ç @test_ref
   üéØ 20% ¬∑ 23.11.2025 00:20

[¬´ –ù–∞–∑–∞–¥ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é]
```

### –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ (FSM):

1. –ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç "üí∞ –ù–∞—á–∏—Å–ª–∏—Ç—å –¥–µ–Ω—å–≥–∏"
2. –í–≤–æ–¥–∏—Ç —Å—É–º–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1000)
3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç
4. –î–µ–Ω—å–≥–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## üîí –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:

- **–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π** - –≤—Å–µ –∞–¥–º–∏–Ω—ã
- **–†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ** - —Ç–æ–ª—å–∫–æ `can_manage_admins()` (creator/developer)

## üìÅ –§–∞–π–ª—ã:

- ‚úÖ `handlers/admin/referral_info.py` - –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
- ‚úÖ `handlers/admin/__init__.py` - –¥–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç
- ‚úÖ `bot.py` - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Ä–æ—É—Ç–µ—Ä
- ‚è≥ `handlers/admin/users.py` - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

–ú–æ–¥—É–ª—å —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤.

**–ö–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–∑ –ª—é–±–æ–≥–æ –º–µ—Å—Ç–∞:**
- `admin_ref_history:{telegram_id}` - –∏—Å—Ç–æ—Ä–∏—è
- `admin_ref_add_money:{telegram_id}` - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ
