# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –Æ–ö–∞—Å—Å—ã –Ω–∞ Prodamus

## üéØ –ì–õ–ê–í–ù–ê–Ø –¶–ï–õ–¨
**–ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –Æ–ö–∞—Å—Å—ã –∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ Prodamus –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—É—é –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É**

## üìã –ò–°–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï
- **Webhook URL:** https://momsclubwebhook.ru/prodamus-webhook
- **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á:** 9c90cf8497c837d976aa51d826be9093aecc4df7359c9c323c7276aa6d2faef7
- **–û—Å–Ω–æ–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞:** https://momsclub.payform.ru

---

## –≠–¢–ê–ü 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### 1.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] **–£–î–ê–õ–ò–¢–¨** –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Æ–ö–∞—Å—Å—ã –∏–∑ `config.py`
- [ ] **–ó–ê–ú–ï–ù–ò–¢–¨** –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Prodamus:
  ```python
  PRODAMUS_CONFIG = {
      "base_url": "https://momsclub.payform.ru",
      "webhook_url": "https://momsclubwebhook.ru/prodamus-webhook", 
      "secret_key": "9c90cf8497c837d976aa51d826be9093aecc4df7359c9c323c7276aa6d2faef7"
  }
  ```
- [ ] –£–±—Ä–∞—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ Prodamus)

### 1.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] **–ó–ê–ú–ï–ù–ò–¢–¨** `yookassa_payment_method_id` –Ω–∞ `payment_method_id` (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ)
- [ ] **–£–î–ê–õ–ò–¢–¨** –ø–æ–ª–µ `payment_provider` (–Ω–µ –Ω—É–∂–Ω–æ, —Ç–æ–ª—å–∫–æ Prodamus)
- [ ] **–î–û–ë–ê–í–ò–¢–¨** `subscription_id` –¥–ª—è —Å–≤—è–∑–∏ —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ Prodamus
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–º–µ–Ω—ã —Å—Ö–µ–º—ã:
  ```sql
  -- –£–î–ê–õ–Ø–ï–ú
  ALTER TABLE users DROP COLUMN yookassa_payment_method_id;
  
  -- –î–û–ë–ê–í–õ–Ø–ï–ú
  ALTER TABLE users ADD COLUMN payment_method_id VARCHAR(255);
  ALTER TABLE subscriptions ADD COLUMN subscription_id VARCHAR(255);
  ALTER TABLE payment_logs ADD COLUMN prodamus_order_id VARCHAR(255);
  ```

### 1.3 –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –º–æ–¥—É–ª—è
- [ ] **–£–î–ê–õ–ò–¢–¨** —Å—Ç–∞—Ä—ã–π `utils/payment.py` (–Æ–ö–∞—Å—Å–∞ –∫–æ–¥)
- [ ] **–°–û–ó–î–ê–¢–¨** –Ω–æ–≤—ã–π `utils/payment.py` —Ç–æ–ª—å–∫–æ –¥–ª—è Prodamus
- [ ] –ù–∏–∫–∞–∫–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π - —Ç–æ–ª—å–∫–æ Prodamus API
- [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
  - `create_payment_link()`
  - `create_autopayment()`
  - `verify_webhook_signature()`

---

## –≠–¢–ê–ü 2: –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏

### 2.1 –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ (Prodamus)
- [ ] –§—É–Ω–∫—Ü–∏—è `create_payment_link_prodamus()`:
  - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ GET-–∑–∞–ø—Ä–æ—Å–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ (`subscription = 1`)
  - –ê–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏—è (`subscription_limit_autopayments`)
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (user_id, sub_type, days)
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏

### 2.2 –ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ Prodamus REST API
- [ ] –§—É–Ω–∫—Ü–∏—è `create_autopayment_prodamus()`:
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
  - REST API –º–µ—Ç–æ–¥—ã:
    - `setActivity` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –ø–æ–¥–ø–∏—Å–æ–∫
    - `setSubscriptionPaymentDate` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞—Ç–∞–º–∏
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–π

### 2.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π Prodamus
- [ ] –§—É–Ω–∫—Ü–∏—è `verify_prodamus_signature()`:
  - HMAC-SHA256 —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º
  - Base64 –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏
  - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é

---

## –≠–¢–ê–ü 3: –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –≤–µ–±—Ö—É–∫–æ–≤

### 3.1 –£–¥–∞–ª–µ–Ω–∏–µ –Æ–ö–∞—Å—Å–∞ endpoints
- [ ] **–£–î–ê–õ–ò–¢–¨** endpoint `/webhook` (–Æ–ö–∞—Å—Å–∞)
- [ ] **–£–î–ê–õ–ò–¢–¨** –≤—Å—é –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–µ–π –Æ–ö–∞—Å—Å—ã
- [ ] **–£–î–ê–õ–ò–¢–¨** –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `payment.succeeded`, `payment.canceled`

### 3.2 –°–æ–∑–¥–∞–Ω–∏–µ Prodamus webhook
- [ ] **–°–û–ó–î–ê–¢–¨** —Ç–æ–ª—å–∫–æ `/prodamus-webhook`
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π Prodamus:
  - `auto_payment` - —É—Å–ø–µ—à–Ω—ã–π –∞–≤—Ç–æ–ø–ª–∞—Ç–µ–∂
  - `deactivation` - –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏  
  - `reactivation` - —Ä–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
  - `finish` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ –±–ª–æ–∫–∞ `subscription` –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –ë–î

### 3.3 –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- [ ] **–ê–î–ê–ü–¢–ò–†–û–í–ê–¢–¨** –ø–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—É Prodamus:
  - `order_id` –≤–º–µ—Å—Ç–æ `payment_id`
  - `subscription.id` –¥–ª—è —Å–≤—è–∑–∏ —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
  - `subscription.active` –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞
  - `subscription.autopayments_num` –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞

---

## –≠–¢–ê–ü 4: –ó–∞—á–∏—Å—Ç–∫–∞ –∫–æ–¥–∞ –æ—Ç –Æ–ö–∞—Å—Å—ã

### 4.1 –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] **–£–î–ê–õ–ò–¢–¨** –∏–∑ `requirements.txt`:
  ```
  yookassa
  ```
- [ ] **–£–î–ê–õ–ò–¢–¨** –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã:
  ```python
  from yookassa import Configuration, Payment
  import yookassa
  ```
- [ ] **–£–î–ê–õ–ò–¢–¨** –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Æ–ö–∞—Å—Å—ã –∏–∑ `.env.example`

### 4.2 –ó–∞—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] **–£–î–ê–õ–ò–¢–¨** –∏–∑ `config.py`:
  ```python
  YOOKASSA_SHOP_ID
  YOOKASSA_SECRET_KEY
  ```
- [ ] **–£–î–ê–õ–ò–¢–¨** –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –Æ–ö–∞—Å—Å—ã –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
- [ ] **–û–ë–ù–û–í–ò–¢–¨** –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### 4.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [ ] `handlers/user_handlers.py` - —Ç–æ–ª—å–∫–æ Prodamus
- [ ] `handlers/admin_handlers.py` - —É–±—Ä–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –Æ–ö–∞—Å—Å—ã
- [ ] `handlers/webhook_handlers.py` - —Ç–æ–ª—å–∫–æ Prodamus –ª–æ–≥–∏–∫–∞
- [ ] –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ª–æ–≥–∏ - —Ç–æ–ª—å–∫–æ Prodamus

---

## –≠–¢–ê–ü 5: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 5.1 –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Æ–ö–∞—Å—Å—ã
- [ ] **–ù–ê–ô–¢–ò** –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å `yookassa_payment_method_id`
- [ ] **–ü–†–û–í–ï–†–ò–¢–¨** –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ —Å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ–º
- [ ] **–≠–ö–°–ü–û–†–¢** –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π –Æ–ö–∞—Å—Å—ã
- [ ] **–°–¢–ê–¢–ò–°–¢–ò–ö–ê** –ø–æ —Ç–∏–ø–∞–º –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –ø–ª–∞—Ç–µ–∂–µ–π

### 5.2 –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] **–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - —Å—Ä–∞–∑—É —Ç–æ–ª—å–∫–æ Prodamus
- [ ] **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–µ–∑ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è** - –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –æ–ø–ª–∞—Ç–µ Prodamus
- [ ] **–° –∞–∫—Ç–∏–≤–Ω—ã–º –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ–º** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ –Ω–µ–¥–µ–ª—é –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
  - –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –∑–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ Prodamus
  - –†—É—á–Ω–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –≤ –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ

### 5.3 –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- [ ] **–°–û–•–†–ê–ù–ò–¢–¨** –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π (–¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)
- [ ] **–ü–ï–†–ï–ù–ï–°–¢–ò** –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç Prodamus
- [ ] **–û–ë–ù–£–õ–ò–¢–¨** —Å—Ç–∞—Ä—ã–µ payment_method_id
- [ ] **–£–í–ï–î–û–ú–ò–¢–¨** –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ —Å–º–µ–Ω–µ —Å–∏—Å—Ç–µ–º—ã

### 5.4 –ú–∞—Å—Å–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –†–∞—Å—Å—ã–ª–∫–∞ –æ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –Ω–æ–≤—É—é –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É
- [ ] –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è
- [ ] –ë–æ–Ω—É—Å—ã/–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –∑–∞ –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞ (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)
- [ ] FAQ –ø–æ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –ø–ª–∞—Ç–µ–∂–µ–π

---

## –≠–¢–ê–ü 6: –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 6.1 –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] **–í–°–ï —Ç–∏–ø—ã –ø–ª–∞—Ç–µ–∂–µ–π** —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ Prodamus
- [ ] **–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –±–µ–∑ —Å–±–æ–µ–≤
- [ ] **–í–°–ï –≤–µ–±—Ö—É–∫–∏** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] **–ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ —Å–∫–∏–¥–∫–∏** —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- [ ] **–î–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è** –∏ –±–æ–Ω—É—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç

### 6.2 –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
- [ ] –ú–∞—Å—Å–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤
- [ ] –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è
- [ ] –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏ —Å–±–æ—è—Ö Prodamus

### 6.3 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –æ–ø–ª–∞—Ç–∞ ‚Üí –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ
- [ ] –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- [ ] –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Telegram Bot API

---

## –≠–¢–ê–ü 7: –§–∏–Ω–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ

### 7.1 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–ø—É—Å–∫—É
- [ ] **–û–¢–ö–õ–Æ–ß–ò–¢–¨** —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –Æ–ö–∞—Å—Å—ã
- [ ] **–î–û–ñ–î–ê–¢–¨–°–Ø** –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö pending –ø–ª–∞—Ç–µ–∂–µ–π –Æ–ö–∞—Å—Å—ã
- [ ] **–§–ò–ù–ê–õ–¨–ù–û–ï —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** Prodamus –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- [ ] **–£–í–ï–î–û–ú–ò–¢–¨** –∫–æ–º–∞–Ω–¥—É –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—é

### 7.2 –î–µ–Ω—å X - –ø–æ–ª–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
- [ ] **–û–¢–ö–õ–Æ–ß–ò–¢–¨** –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Æ–ö–∞—Å—Å—ã
- [ ] **–£–î–ê–õ–ò–¢–¨** webhook –Æ–ö–∞—Å—Å—ã –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [ ] **–í–ö–õ–Æ–ß–ò–¢–¨** —Ç–æ–ª—å–∫–æ Prodamus –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- [ ] **–ú–û–ù–ò–¢–û–†–ò–ù–ì** –ø–µ—Ä–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π

### 7.3 –ü–æ—Å—Ç-–∑–∞–ø—É—Å–∫ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- [ ] –£—Å–∏–ª–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–≤—ã–µ 48 —á–∞—Å–æ–≤
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- [ ] –û–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- [ ] –°–±–æ—Ä –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üóëÔ∏è –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö –£–î–ê–õ–ï–ù–ò–Ø

### –§–∞–π–ª—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```
‚ùå –£–î–ê–õ–ò–¢–¨ –ü–û–õ–ù–û–°–¢–¨–Æ:
‚îú‚îÄ‚îÄ yookassa –∏–∑ requirements.txt
‚îú‚îÄ‚îÄ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã yookassa
‚îú‚îÄ‚îÄ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ YOOKASSA_* 
‚îú‚îÄ‚îÄ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –Æ–ö–∞—Å—Å–æ–π
‚îú‚îÄ‚îÄ –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ –Æ–ö–∞—Å—Å—ã
‚îú‚îÄ‚îÄ –í—Å–µ –ø–æ–ª—è yookassa_* –∏–∑ –ë–î
‚îî‚îÄ‚îÄ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –Æ–ö–∞—Å—Å–µ

‚úÖ –û–°–¢–ê–í–ò–¢–¨ –¢–û–õ–¨–ö–û:
‚îú‚îÄ‚îÄ utils/payment.py (—Ç–æ–ª—å–∫–æ Prodamus)
‚îú‚îÄ‚îÄ /prodamus-webhook endpoint
‚îú‚îÄ‚îÄ Prodamus REST API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ payment_method_id (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ)
‚îî‚îÄ‚îÄ Prodamus –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - –º–∏–≥—Ä–∞—Ü–∏—è
```sql
-- 1. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è –Æ–ö–∞—Å—Å—ã
ALTER TABLE users DROP COLUMN yookassa_payment_method_id;

-- 2. –î–æ–±–∞–≤–ª—è–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
ALTER TABLE users ADD COLUMN payment_method_id VARCHAR(255);
ALTER TABLE subscriptions ADD COLUMN subscription_id VARCHAR(255);
ALTER TABLE payment_logs ADD COLUMN prodamus_order_id VARCHAR(255);

-- 3. –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Æ–ö–∞—Å—Å—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã)
UPDATE payment_logs SET transaction_id = NULL WHERE payment_method = 'yookassa';
```

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 1. –ù—É–ª–µ–≤–∞—è –ø–æ—Ç–µ—Ä—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–ù–ò –û–î–ò–ù –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** —Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–æ–π –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ—Ç–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø
- **–í–°–ï –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è** –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏–ª–∏ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã
- **–ó–ê–ë–õ–ê–ì–û–í–†–ï–ú–ï–ù–ù–´–ï —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ —Å–º–µ–Ω–µ —Å–∏—Å—Ç–µ–º—ã

### 2. –ü–æ–ª–Ω–∞—è –∑–∞—á–∏—Å—Ç–∫–∞ –Æ–ö–∞—Å—Å—ã
- **–ù–û–õ–¨ —Å—Ç—Ä–æ–∫** –∫–æ–¥–∞ –Æ–ö–∞—Å—Å—ã –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
- **–ù–û–õ–¨ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** –æ—Ç –Æ–ö–∞—Å—Å—ã
- **–ù–û–õ–¨ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π** –Æ–ö–∞—Å—Å—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 3. –ë–µ—Å—à–æ–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** –≤—Å–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- **–ò–¥–µ–Ω—Ç–∏—á–Ω–æ–µ** –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–£–ª—É—á—à–µ–Ω–Ω–∞—è** –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ Prodamus

---

## üìä –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–®–ù–û–°–¢–ò

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ **100% —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å** –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ Prodamus
- ‚úÖ **0 –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤** —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏  
- ‚úÖ **0 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** –Æ–ö–∞—Å—Å—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ
- ‚úÖ **100% –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–π** –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ Prodamus
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏** –ø–ª–∞—Ç–µ–∂–µ–π (¬± 5%)

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- ‚úÖ **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞** –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã < 2 —Å–µ–∫
- ‚úÖ **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏** –≤–µ–±—Ö—É–∫–æ–≤ > 99%
- ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö** –æ—à–∏–±–æ–∫ 48 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
- ‚úÖ **–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üöÄ –°–¢–†–£–ö–¢–£–†–ê –§–ò–ù–ê–õ–¨–ù–û–ì–û –ü–†–û–ï–ö–¢–ê

### –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Ñ–∞–π–ª—ã (—Ç–æ–ª—å–∫–æ Prodamus)
```
utils/
‚îî‚îÄ‚îÄ payment.py                 # –¢–æ–ª—å–∫–æ Prodamus API

handlers/
‚îú‚îÄ‚îÄ webhook_handlers.py        # –¢–æ–ª—å–∫–æ /prodamus-webhook
‚îú‚îÄ‚îÄ user_handlers.py          # –ë–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –Æ–ö–∞—Å—Å—ã
‚îî‚îÄ‚îÄ admin_handlers.py         # –¢–æ–ª—å–∫–æ Prodamus –∫–æ–º–∞–Ω–¥—ã

config.py                     # –¢–æ–ª—å–∫–æ PRODAMUS_CONFIG
requirements.txt              # –ë–µ–∑ yookassa
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –ø–æ–ª—è)
```sql
users:
‚îú‚îÄ‚îÄ payment_method_id         # –í–º–µ—Å—Ç–æ yookassa_payment_method_id
‚îî‚îÄ‚îÄ is_recurring_active       # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ

subscriptions:
‚îú‚îÄ‚îÄ subscription_id           # ID –ø–æ–¥–ø–∏—Å–∫–∏ Prodamus
‚îî‚îÄ‚îÄ renewal_price            # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ

payment_logs:
‚îú‚îÄ‚îÄ prodamus_order_id        # order_id –æ—Ç Prodamus
‚îî‚îÄ‚îÄ transaction_id           # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ
```

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç:**
- –†–∞–±–æ—Ç–∞—Ç—å **–¢–û–õ–¨–ö–û** –Ω–∞ Prodamus
- **–ù–ï –°–û–î–ï–†–ñ–ê–¢–¨** –∫–æ–¥–∞ –Æ–ö–∞—Å—Å—ã
- **–°–û–•–†–ê–ù–Ø–¢–¨** –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–∫–∏
- **–û–ë–ï–°–ü–ï–ß–ò–í–ê–¢–¨** –ª—É—á—à—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ–¥–ø–∏—Å–æ–∫
- **–ü–û–î–î–ï–†–ñ–ò–í–ê–¢–¨** –≤–µ—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.**
 