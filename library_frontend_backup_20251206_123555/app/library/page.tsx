'use client'

import { useEffect, useState } from 'react'
import { useRouter } from 'next/navigation'
import Link from 'next/link'
import { api } from '@/lib/api'
import { usePresence } from '@/hooks/usePresence'

// –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤
const ADMIN_IDS = [534740911, 44054166]

// –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–º–∏)
const defaultUser = {
  name: '–ì–æ—Å—Ç—å',
  avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Guest&backgroundColor=ffdfbf',
  subscriptionDaysLeft: 0,
  subscriptionTotal: 30,
  loyaltyLevel: 'none' as const,
  daysInClub: 0,
  materialsViewed: 0,
  uniqueViewed: 0,
  favorites: 0,
  totalMaterials: 0,
  notifications: 0,
}

const loyaltyBadges = {
  none: { label: '–ù–æ–≤–∏—á–æ–∫', color: 'bg-gray-100 text-gray-600', icon: 'üå±', bonus: '10% —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å', daysInClub: 0, nextLevel: 'Silver', daysToNext: 90 },
  silver: { label: 'Silver', color: 'bg-gradient-to-r from-gray-200 to-gray-300 text-gray-700', icon: 'ü•à', bonus: '15% —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å', daysInClub: 90, nextLevel: 'Gold', daysToNext: 180 },
  gold: { label: 'Gold', color: 'bg-gradient-to-r from-amber-100 to-amber-200 text-amber-700', icon: 'ü•á', bonus: '20% —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å', daysInClub: 180, nextLevel: 'Platinum', daysToNext: 365 },
  platinum: { label: 'Platinum', color: 'bg-gradient-to-r from-purple-100 to-purple-200 text-purple-700', icon: 'üíé', bonus: '30% —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å', daysInClub: 365, nextLevel: null, daysToNext: null },
}

// –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ API (apiCategories)

// 365 –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–∏—Ç–∞—Ç –Ω–∞ –≥–æ–¥
const dailyQuotes = [
  '–¢–≤–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç ‚Äî —ç—Ç–æ —Ç–≤–æ—è —Å—É–ø–µ—Ä—Å–∏–ª–∞. –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç —Ç–µ–±—è –∫ –º–µ—á—Ç–µ! üí´',
  '–ù–µ –±–æ–π—Å—è –±—ã—Ç—å —Å–æ–±–æ–π. –¢–≤–æ—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî —Ç–≤–æ—ë –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ ‚ú®',
  '–£—Å–ø–µ—Ö ‚Äî —ç—Ç–æ —Å—É–º–º–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —à–∞–≥–æ–≤, –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã—Ö –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üöÄ',
  '–¢–≤–æ–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –∂–¥—É—Ç –∏–º–µ–Ω–Ω–æ —Ç–µ–±—è. –ü–æ–∫–∞–∂–∏ –∏–º –Ω–∞—Å—Ç–æ—è—â—É—é —Å–µ–±—è üíñ',
  '–ö–∞–∂–¥—ã–π —ç–∫—Å–ø–µ—Ä—Ç –∫–æ–≥–¥–∞-—Ç–æ –±—ã–ª –Ω–æ–≤–∏—á–∫–æ–º. –ü—Ä–æ–¥–æ–ª–∂–∞–π –¥–≤–∏–≥–∞—Ç—å—Å—è! üåü',
  '–ö–æ–Ω—Ç–µ–Ω—Ç ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ –∏–¥–µ–∞–ª—å–Ω–æ—Å—Ç—å, –∞ –ø—Ä–æ –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å üí¨',
  '–¢–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç –¥—Ä—É–≥–∏—Ö. –†–∞—Å—Å–∫–∞–∑—ã–≤–∞–π –µ—ë —Å–º–µ–ª–æ! üìñ',
  '–°–µ–≥–æ–¥–Ω—è ‚Äî –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ üåÖ',
  '–ú–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã –≤–µ–¥—É—Ç –∫ –±–æ–ª—å—à–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º üèÜ',
  '–¢–≤–æ—è –∞—É–¥–∏—Ç–æ—Ä–∏—è —Ä–∞—Å—Ç—ë—Ç –≤–º–µ—Å—Ç–µ —Å —Ç–æ–±–æ–π üìà',
  '–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ –º—ã—à—Ü–∞. –ß–µ–º –±–æ–ª—å—à–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å, —Ç–µ–º —Å–∏–ª—å–Ω–µ–µ –æ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è üí™',
  '–ù–µ —Å—Ä–∞–≤–Ω–∏–≤–∞–π —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —à–∞–≥ —Å —á—å–∏–º-—Ç–æ —Å–æ—Ç—ã–º üë£',
  '–¢–≤–æ–π –≥–æ–ª–æ—Å –≤–∞–∂–µ–Ω. –ú–∏—Ä –∂–¥—ë—Ç, —á—Ç–æ —Ç—ã —Å–∫–∞–∂–µ—à—å üé§',
  '–û—à–∏–±–∫–∏ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ–≤–∞–ª, –∞ –æ–±—É—á–µ–Ω–∏–µ üìö',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—å –ª—É—á—à–µ üåà',
  '–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –∑–∞—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞. –î–µ–ª–∏—Å—å –µ—é! ‚ö°',
  '–ë—É–¥—å —Ç–µ—Ä–ø–µ–ª–∏–≤–∞ –∫ —Å–µ–±–µ ‚Äî –≤–µ–ª–∏–∫–∏–µ –¥–µ–ª–∞ —Ç—Ä–µ–±—É—é—Ç –≤—Ä–µ–º–µ–Ω–∏ ‚è∞',
  '–¢–≤–æ–∏ –∏–¥–µ–∏ –∑–∞—Å–ª—É–∂–∏–≤–∞—é—Ç –±—ã—Ç—å —É—Å–ª—ã—à–∞–Ω–Ω—ã–º–∏ üí°',
  '–°—Ç—Ä–∞—Ö ‚Äî —ç—Ç–æ –∫–æ–º–ø–∞—Å, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ —Ä–æ—Å—Ç üß≠',
  '–¢—ã —É–∂–µ –¥–∞–ª—å—à–µ, —á–µ–º –±—ã–ª–∞ –≤—á–µ—Ä–∞ üéØ',
  '–ù–∞—Å—Ç–æ—è—â–∏–π —É—Å–ø–µ—Ö ‚Äî —ç—Ç–æ –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ü–µ–ª—è–º–∏ –∏ —Å—á–∞—Å—Ç—å–µ–º ‚öñÔ∏è',
  '–¢–≤–æ—è –∞—É—Ç–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ –º–∞–≥–Ω–∏—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ª—é–¥–µ–π üß≤',
  '–ù–µ –∂–¥–∏ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ ‚Äî —Å–æ–∑–¥–∞–π –µ–≥–æ —Å–∞–º–∞ üî•',
  '–ö–∞–∂–¥—ã–π –ª–∞–π–∫ ‚Äî —ç—Ç–æ —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç—ã –≤–¥–æ—Ö–Ω–æ–≤–∏–ª–∞ ‚ù§Ô∏è',
  '–¢–≤–æ–π –ø—É—Ç—å —É–Ω–∏–∫–∞–ª–µ–Ω, –∏ —ç—Ç–æ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ ü¶ã',
  '–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –¥–µ–π—Å—Ç–≤–∏–µ, –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç üé®',
  '–¢—ã —Å–ø–æ—Å–æ–±–Ω–∞ –Ω–∞ –±–æ–ª—å—à–µ–µ, —á–µ–º –¥—É–º–∞–µ—à—å üíé',
  '–ö–æ–º—å—é–Ω–∏—Ç–∏ ‚Äî —ç—Ç–æ —Å–∏–ª–∞. –í–º–µ—Å—Ç–µ –º—ã —Å–∏–ª—å–Ω–µ–µ ü§ù',
  '–¢–≤–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –º–µ–Ω—è–µ—Ç —á—å—é-—Ç–æ –∂–∏–∑–Ω—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å üåç',
  '–ë—É–¥—å —Å–º–µ–ª–æ–π –≤ —Å–≤–æ–∏—Ö –º–µ—á—Ç–∞—Ö ü¶Å',
  // –Ø–Ω–≤–∞—Ä—å (31)
  '–ù–æ–≤—ã–π –º–µ—Å—è—Ü ‚Äî –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏! üóìÔ∏è',
  '–ü–ª–∞–Ω–∏—Ä—É–π —Å–º–µ–ª–æ, –¥–µ–π—Å—Ç–≤—É–π —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ üìã',
  '–¢–≤–æ–∏ —Ü–µ–ª–∏ –¥–æ—Å—Ç–∏–∂–∏–º—ã, –µ—Å–ª–∏ –¥–≤–∏–≥–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üéØ',
  '–ó–∏–º–∞ ‚Äî –≤—Ä–µ–º—è –¥–ª—è —Ç—ë–ø–ª–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ‚ùÑÔ∏è',
  '–£—é—Ç –∏ –∑–∞–±–æ—Ç–∞ ‚Äî —Ç–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã üè†',
  '–Ø–Ω–≤–∞—Ä—å ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π üåü',
  '–ü–æ–¥–µ–ª–∏—Å—å —Å–≤–æ–∏–º–∏ –ø–ª–∞–Ω–∞–º–∏ ‚Äî —ç—Ç–æ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç –¥—Ä—É–≥–∏—Ö üìù',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî —á–∏—Å—Ç—ã–π –ª–∏—Å—Ç –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ ‚úèÔ∏è',
  '–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –∑–∞–¥–∞—ë—Ç —Ç–æ–Ω –≤—Å–µ–º—É –¥–Ω—é ‚òÄÔ∏è',
  '–ú–∞–ª–µ–Ω—å–∫–∏–µ —Ä–∏—Ç—É–∞–ª—ã —Å–æ–∑–¥–∞—é—Ç –±–æ–ª—å—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã üßò',
  // –§–µ–≤—Ä–∞–ª—å (28)
  '–õ—é–±–æ–≤—å –∫ —Å–µ–±–µ ‚Äî –æ—Å–Ω–æ–≤–∞ –≤—Å–µ–≥–æ üíï',
  '–î–µ–ª–∏—Å—å –ª—é–±–æ–≤—å—é —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–Ω—Ç üíù',
  '–¢–≤–æ—è –∑–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç –¥—Ä—É–≥–∏—Ö üõÅ',
  '–§–µ–≤—Ä–∞–ª—å ‚Äî –º–µ—Å—è—Ü —Ç—ë–ø–ª—ã—Ö —ç–º–æ—Ü–∏–π üåπ',
  '–ò—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤—Å–µ–≥–¥–∞ –ø–æ–±–µ–∂–¥–∞–µ—Ç üíñ',
  '–¢–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞ ‚Äî —ç—Ç–æ —Å–∏–ª–∞, –Ω–µ —Å–ª–∞–±–æ—Å—Ç—å üíó',
  '–°–æ–∑–¥–∞–≤–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å –ª—é–±–æ–≤—å—é üíì',
  '–ö–∞–∂–¥—ã–π –ø–æ—Å—Ç ‚Äî –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –≤ –ª—é–±–≤–∏ –∫ —Å–≤–æ–µ–º—É –¥–µ–ª—É üíò',
  // –ú–∞—Ä—Ç (31)
  '–í–µ—Å–Ω–∞ ‚Äî –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —Ä–æ—Å—Ç–∞ üå±',
  '–ü—Ä–∏—Ä–æ–¥–∞ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è, –∏ —Ç–≤–æ–π –±–ª–æ–≥ —Ç–æ–∂–µ! üå∏',
  '–ù–æ–≤—ã–µ –∏–¥–µ–∏ —Ä–∞—Å—Ü–≤–µ—Ç–∞—é—Ç –∫–∞–∫ —Ü–≤–µ—Ç—ã üå∑',
  '–°–≤–µ–∂–∏–π –≤–∑–≥–ª—è–¥ –Ω–∞ –ø—Ä–∏–≤—ã—á–Ω—ã–µ –≤–µ—â–∏ üëÄ',
  '–ú–∞—Ä—Ç ‚Äî –≤—Ä–µ–º—è –ø–µ—Ä–µ–º–µ–Ω –∫ –ª—É—á—à–µ–º—É ü¶ã',
  '–û–±–Ω–æ–≤–ª—è–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤–º–µ—Å—Ç–µ —Å –ø—Ä–∏—Ä–æ–¥–æ–π üåø',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–≤–µ—Ç–ª–µ–µ ‚òÄÔ∏è',
  '–¢–≤–æ—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞—Å–ø—É—Å–∫–∞–µ—Ç—Å—è üé®',
  // –ê–ø—Ä–µ–ª—å (30)
  '–ê–ø—Ä–µ–ª—å ‚Äî –º–µ—Å—è—Ü —ç–Ω–µ—Ä–≥–∏–∏ –∏ –¥–≤–∏–∂–µ–Ω–∏—è üèÉ‚Äç‚ôÄÔ∏è',
  '–í—Ä–µ–º—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ üí™',
  '–í–µ—Å–µ–Ω–Ω—è—è —ç–Ω–µ—Ä–≥–∏—è –∑–∞—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞ ‚ö°',
  '–î–µ–ª–∏—Å—å —Å–≤–æ–µ–π –±–æ–¥—Ä–æ—Å—Ç—å—é üåû',
  '–ù–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã —Ç—Ä–µ–±—É—é—Ç —Å–º–µ–ª–æ—Å—Ç–∏ üöÄ',
  '–ê–ø—Ä–µ–ª—å—Å–∫–∏–π –¥–æ–∂–¥—å –ø—Ä–∏–Ω–æ—Å–∏—Ç –º–∞–π—Å–∫–∏–µ —Ü–≤–µ—Ç—ã üåßÔ∏è',
  // –ú–∞–π (31)
  '–ú–∞–π ‚Äî –≤—Ä–µ–º—è —Ä–∞—Å—Ü–≤–µ—Ç–∞! üå∫',
  '–¢–≤–æ–π –±–ª–æ–≥ —Ä–∞—Å—Ü–≤–µ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ —Å –ø—Ä–∏—Ä–æ–¥–æ–π üåª',
  '–ö—Ä–∞—Å–æ—Ç–∞ –≤–æ–∫—Ä—É–≥ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç üì∏',
  '–î–µ–ª–∏—Å—å —è—Ä–∫–∏–º–∏ –º–æ–º–µ–Ω—Ç–∞–º–∏ üåà',
  '–ú–∞–π—Å–∫–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤ –∫–∞–∂–¥–æ–º –ø–æ—Å—Ç–µ üéÄ',
  '–¢–µ–ø–ª–æ –∏ —Ä–∞–¥–æ—Å—Ç—å ‚Äî —Ç–≤–æ–∏ —Ç–µ–º—ã üòä',
  // –ò—é–Ω—å (30)
  '–õ–µ—Ç–æ ‚Äî –≤—Ä–µ–º—è –ª—ë–≥–∫–æ—Å—Ç–∏ –∏ —Å–≤–æ–±–æ–¥—ã ‚òÄÔ∏è',
  '–ò—é–Ω—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–µ–∑–æ–Ω –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è üèñÔ∏è',
  '–°–æ–ª–Ω–µ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –¥–Ω–µ–π üå¥',
  '–î–µ–ª–∏—Å—å –ª–µ—Ç–Ω–∏–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º üç¶',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –º–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫ üéâ',
  '–õ—ë–≥–∫–æ—Å—Ç—å –±—ã—Ç–∏—è –≤ –∫–∞–∂–¥–æ–º –ø–æ—Å—Ç–µ ü¶©',
  // –ò—é–ª—å (31)
  '–°–µ—Ä–µ–¥–∏–Ω–∞ –≥–æ–¥–∞ ‚Äî –≤—Ä–µ–º—è –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ üìä',
  '–û–≥–ª—è–Ω–∏—Å—å –Ω–∞–∑–∞–¥ –∏ –ø–æ—Ä–∞–¥—É–π—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å—É üéØ',
  '–ò—é–ª—å—Å–∫–∞—è –∂–∞—Ä–∞ ‚Äî –≥–æ—Ä—è—á–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç! üî•',
  '–û—Ç–¥—ã—Ö ‚Äî —Ç–æ–∂–µ —á–∞—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ üèùÔ∏è',
  '–ë–∞–ª–∞–Ω—Å ‚Äî –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É ‚öñÔ∏è',
  '–ù–∞—Å–ª–∞–∂–¥–∞–π—Å—è –º–æ–º–µ–Ω—Ç–æ–º üß°',
  // –ê–≤–≥—É—Å—Ç (31)
  '–ê–≤–≥—É—Å—Ç ‚Äî –≤—Ä–µ–º—è —Å–æ–±–∏—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π –∏–¥–µ–π üåæ',
  '–ü–æ–¥–≤–æ–¥–∏ –∏—Ç–æ–≥–∏ –ª–µ—Ç–∞ ‚òÄÔ∏è',
  '–ì–æ—Ç–æ–≤—å—Å—è –∫ –æ—Å–µ–Ω–Ω–µ–º—É —Å–µ–∑–æ–Ω—É üçÇ',
  '–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü –ª–µ—Ç–∞ ‚Äî –æ—Å–æ–±–µ–Ω–Ω—ã–π üåÖ',
  '–°–æ—Ö—Ä–∞–Ω—è–π –ª–µ—Ç–Ω—é—é —ç–Ω–µ—Ä–≥–∏—é üíõ',
  '–î–µ–ª–∏—Å—å —Ç—ë–ø–ª—ã–º–∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏ üì∑',
  // –°–µ–Ω—Ç—è–±—Ä—å (30)
  '–°–µ–Ω—Ç—è–±—Ä—å ‚Äî –Ω–æ–≤—ã–π —Å—Ç–∞—Ä—Ç! üìö',
  '–û—Å–µ–Ω—å ‚Äî –≤—Ä–µ–º—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ üçÅ',
  '–ù–æ–≤—ã–µ —Ü–µ–ª–∏, –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç üéØ',
  '–£—é—Ç–Ω—ã–π —Å–µ–∑–æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è üß£',
  '–í—Ä–µ–º—è –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ üí≠',
  '–û—Å–µ–Ω–Ω–∏–µ –∫—Ä–∞—Å–∫–∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç üé®',
  // –û–∫—Ç—è–±—Ä—å (31)
  '–û–∫—Ç—è–±—Ä—å ‚Äî –º–µ—Å—è—Ü —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π ü¶ã',
  '–ó–æ–ª–æ—Ç–∞—è –æ—Å–µ–Ω—å ‚Äî –∑–æ–ª–æ—Ç–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç ‚ú®',
  '–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ –ø–æ—Å—Ç—ã –¥–ª—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–≥–æ —Å–µ–∑–æ–Ω–∞ üïØÔ∏è',
  '–£—é—Ç –∏ —Ç–µ–ø–ª–æ –≤ –∫–∞–∂–¥–æ–º —Å–ª–æ–≤–µ ‚òï',
  '–í—Ä–µ–º—è –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ –∏ —Ä–æ—Å—Ç–∞ üåô',
  '–•—ç–ª–ª–æ—É–∏–Ω ‚Äî –≤—Ä–µ–º—è –∫—Ä–µ–∞—Ç–∏–≤–∞ üéÉ',
  // –ù–æ—è–±—Ä—å (30)
  '–ù–æ—è–±—Ä—å ‚Äî –º–µ—Å—è—Ü –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ üôè',
  '–¶–µ–Ω–∏ —Ç–æ, —á—Ç–æ –∏–º–µ–µ—à—å üíñ',
  '–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç –∏–∑–æ–±–∏–ª–∏–µ ‚ú®',
  '–î–µ–ª–∏—Å—å —Ç–µ–ø–ª–æ–º –≤ —Ö–æ–ª–æ–¥–Ω—ã–µ –¥–Ω–∏ üß°',
  '–ö–∞–∂–¥—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫ ‚Äî –ø–æ–¥–∞—Ä–æ–∫ üéÅ',
  '–ì–æ—Ç–æ–≤—å—Å—è –∫ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–º—É —Å–µ–∑–æ–Ω—É üéÑ',
  // –î–µ–∫–∞–±—Ä—å (31)
  '–î–µ–∫–∞–±—Ä—å ‚Äî –≤–æ–ª—à–µ–±–Ω—ã–π –º–µ—Å—è—Ü! üéÖ',
  '–ü—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ üéÑ',
  '–ü–æ–¥–≤–æ–¥–∏ –∏—Ç–æ–≥–∏ –≥–æ–¥–∞ üìä',
  '–°—Ç—Ä–æ–π –ø–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ üóìÔ∏è',
  '–î–µ–ª–∏—Å—å –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º üéÅ',
  '–ù–æ–≤—ã–π –≥–æ–¥ ‚Äî –Ω–æ–≤—ã–µ –º–µ—á—Ç—ã üåü',
  '–ó–∏–º–Ω—è—è —Å–∫–∞–∑–∫–∞ –≤ –∫–∞–∂–¥–æ–º –ø–æ—Å—Ç–µ ‚ùÑÔ∏è',
  '–¢–µ–ø–ª–æ –∏ —Ä–∞–¥–æ—Å—Ç—å ‚Äî –≥–ª–∞–≤–Ω—ã–µ —Ç–µ–º—ã üïØÔ∏è',
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ (–¥–æ 365)
  '–ë—É–¥—å —Å–æ–±–æ–π ‚Äî –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–æ–ª–∏ —É–∂–µ –∑–∞–Ω—è—Ç—ã üí´',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî —à–∞–Ω—Å —Å—Ç–∞—Ç—å –ª—É—á—à–µ üåÖ',
  '–¢–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è üìñ',
  '–í–µ—Ä—å –≤ —Å–µ–±—è –¥–∞–∂–µ –∫–æ–≥–¥–∞ —Å–ª–æ–∂–Ω–æ üí™',
  '–¢—ã —Å–æ–∑–¥–∞—ë—à—å —Å–≤–æ—é —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å üé®',
  '–ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ –≤–µ–¥—É—Ç –∫ –±–æ–ª—å—à–∏–º —Ü–µ–ª—è–º üë£',
  '–¢–≤–æ–π –≥–æ–ª–æ—Å –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ üé§',
  '–ù–µ –±–æ–π—Å—è –º–µ—á—Ç–∞—Ç—å –ø–æ-–∫—Ä—É–ø–Ω–æ–º—É üåà',
  '–ö–∞–∂–¥–∞—è –Ω–µ—É–¥–∞—á–∞ ‚Äî —É—Ä–æ–∫ üìö',
  '–¢—ã —Å–∏–ª—å–Ω–µ–µ, —á–µ–º –¥—É–º–∞–µ—à—å üíé',
  '–°–µ–≥–æ–¥–Ω—è ‚Äî –ø–æ–¥–∞—Ä–æ–∫, –ø–æ—ç—Ç–æ–º—É –æ–Ω –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞—Å—Ç–æ—è—â–µ–µ üéÅ',
  '–¢–≤–æ—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî —Ç–≤–æ—è —Å–∏–ª–∞ ‚ö°',
  '–î–≤–∏–≥–∞–π—Å—è –≤–ø–µ—Ä—ë–¥, –Ω–µ –æ–≥–ª—è–¥—ã–≤–∞—è—Å—å üöÄ',
  '–°—á–∞—Å—Ç—å–µ ‚Äî —ç—Ç–æ –ø—É—Ç—å, –∞ –Ω–µ –ø—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è üõ§Ô∏è',
  '–¢—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å —É—Å–ø–µ—Ö–∞ üèÜ',
  '–ö–∞–∂–¥—ã–π —ç–∫—Å–ø–µ—Ä—Ç –±—ã–ª –∫–æ–≥–¥–∞-—Ç–æ –Ω–æ–≤–∏—á–∫–æ–º üå±',
  '–¢–≤–æ–∏ –º–µ—á—Ç—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã üí≠',
  '–£–ø–æ—Ä—Å—Ç–≤–æ –ø–æ–±–µ–∂–¥–∞–µ—Ç —Ç–∞–ª–∞–Ω—Ç ü•á',
  '–¢—ã ‚Äî –∞–≤—Ç–æ—Ä —Å–≤–æ–µ–π –∏—Å—Ç–æ—Ä–∏–∏ ‚úçÔ∏è',
  '–°–∏—è–π —Å–≤–æ–∏–º —Å–≤–µ—Ç–æ–º üåü',
  '–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç –¥—Ä—É–≥–∏—Ö üíñ',
  '–ë—É–¥—å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–∞ –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üôè',
  '–¢–≤–æ–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –±–µ–∑–≥—Ä–∞–Ω–∏—á–µ–Ω ‚àû',
  '–ö–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å üéØ',
  '–¢—ã –º–µ–Ω—è–µ—à—å –º–∏—Ä —Å–≤–æ–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º üåç',
  '–ù–µ —Å–¥–∞–≤–∞–π—Å—è ‚Äî —Ç—ã –ø–æ—á—Ç–∏ —É —Ü–µ–ª–∏ üèÅ',
  '–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –∑–∞—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞ üî•',
  '–ë—É–¥—å —Å–º–µ–ª–æ–π, –±—É–¥—å —Å–æ–±–æ–π ü¶Å',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤–∞—è –≥–ª–∞–≤–∞ üìñ',
  '–¢—ã —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –¥–µ–ª ‚ú®',
  '–ü—Ä–æ–¥–æ–ª–∂–∞–π –∏–¥—Ç–∏ ‚Äî –ø—É—Ç—å –ø–æ—è–≤–∏—Ç—Å—è üõ§Ô∏è',
  '–¢–≤–æ–∏ –∏–¥–µ–∏ –º–µ–Ω—è—é—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å üí°',
  '–í–µ—Ä—å –≤ –ø—Ä–æ—Ü–µ—Å—Å üåä',
  '–¢—ã ‚Äî –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –¥–ª—è –º–Ω–æ–≥–∏—Ö üí´',
  '–ö–∞–∂–¥—ã–π –ø–æ—Å—Ç ‚Äî –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ –±—É–¥—É—â–µ–µ üìà',
  '–¢–≤–æ—è —Å—Ç—Ä–∞—Å—Ç—å ‚Äî —Ç–≤–æ–π –∫–æ–º–ø–∞—Å üß≠',
  '–ù–µ –±–æ–π—Å—è —Å–∏—è—Ç—å —è—Ä–∫–æ ‚òÄÔ∏è',
  '–¢—ã —É–∂–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏ üéØ',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è —Å–∏–ª—å–Ω–µ–µ üí™',
  '–¢–≤–æ–∏ —Å–ª–æ–≤–∞ –∏–º–µ—é—Ç —Å–∏–ª—É üìù',
  '–ë—É–¥—å —Ç–µ—Ä–ø–µ–ª–∏–≤–∞ ‚Äî –≤—Å—ë –ø—Ä–∏–¥—ë—Ç ‚è∞',
  '–¢—ã ‚Äî —á–∞—Å—Ç—å —á–µ–≥–æ-—Ç–æ –±–æ–ª—å—à–µ–≥–æ üåå',
  '–ö–∞–∂–¥–∞—è –∏–¥–µ—è –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç —à–∞–Ω—Å–∞ üí≠',
  '–¢–≤–æ—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞ üé®',
  '–ü—Ä–æ–¥–æ–ª–∂–∞–π —Ç–≤–æ—Ä–∏—Ç—å ‚Äî –º–∏—Ä –∂–¥—ë—Ç üåç',
  '–¢—ã –¥–µ–ª–∞–µ—à—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ–µ –≤–æ–∑–º–æ–∂–Ω—ã–º ‚ú®',
  '–ö–∞–∂–¥—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π ‚Äî —Å–≤—è–∑—å üí¨',
  '–¢–≤–æ—è –∞—É–¥–∏—Ç–æ—Ä–∏—è —Ü–µ–Ω–∏—Ç —Ç–µ–±—è ‚ù§Ô∏è',
  '–ë—É–¥—å –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ–π –≤ –º–µ—á—Ç–∞—Ö üåü',
  '–¢—ã ‚Äî –ø—Ä–∏–º–µ—Ä –¥–ª—è –ø–æ–¥—Ä–∞–∂–∞–Ω–∏—è üëë',
  '–ö–∞–∂–¥—ã–π —Å—Ç–æ—Ä–∏—Å ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å üì±',
  '–¢–≤–æ—è –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å ‚Äî –º–∞–≥–Ω–∏—Ç üß≤',
  '–ù–µ –ø–µ—Ä–µ—Å—Ç–∞–≤–∞–π —É—á–∏—Ç—å—Å—è üìö',
  '–¢—ã —Ä–∞—Å—Ç—ë—à—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üå±',
  '–ö–∞–∂–¥—ã–π —Ä–∏–ª—Å ‚Äî —à–∞–≥ –∫ —Ü–µ–ª–∏ üé¨',
  '–¢–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è –≤–∞–∂–Ω–∞ üìñ',
  '–ë—É–¥—å –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–æ–≤–æ–º—É üö™',
  '–¢—ã ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è üí´',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –ø–æ–±–µ–¥–∞ üèÜ',
  '–¢–≤–æ—è —Ä–∞–±–æ—Ç–∞ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª üíé',
  '–ü—Ä–æ–¥–æ–ª–∂–∞–π –≤–µ—Ä–∏—Ç—å –≤ —Å–µ–±—è üíñ',
  '–¢—ã –¥–µ–ª–∞–µ—à—å –º–∏—Ä –ª—É—á—à–µ üåà',
  '–ö–∞–∂–¥—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫ ‚Äî –¥—Ä—É–≥ ü§ù',
  '–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç —É—Å–ø–µ—Ö üß≤',
  '–ë—É–¥—å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–∞ –∑–∞ –ø—É—Ç—å üôè',
  '–¢—ã ‚Äî –ª–∏–¥–µ—Ä —Å–≤–æ–µ–π –∂–∏–∑–Ω–∏ üëë',
  '–ö–∞–∂–¥—ã–π –ø–æ—Å—Ç ‚Äî —Ç–≤–æ–π –≥–æ–ª–æ—Å üé§',
  '–¢–≤–æ—è —Å—Ç—Ä–∞—Å—Ç—å –∑–∞—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞ üî•',
  '–ù–µ –±–æ–π—Å—è –±—ã—Ç—å –ø–µ—Ä–≤–æ–π ü•á',
  '–¢—ã —Å–æ–∑–¥–∞—ë—à—å —Ç—Ä–µ–Ω–¥—ã ‚ú®',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤–æ–µ –Ω–∞—á–∞–ª–æ üåÖ',
  '–¢–≤–æ—è —Å–º–µ–ª–æ—Å—Ç—å –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç ü¶Å',
  '–ü—Ä–æ–¥–æ–ª–∂–∞–π –¥–µ–ª–∞—Ç—å —Ç–æ, —á—Ç–æ –ª—é–±–∏—à—å ‚ù§Ô∏è',
  '–¢—ã ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å–Ω–µ–∂–∏–Ω–∫–∞ ‚ùÑÔ∏è',
  '–ö–∞–∂–¥—ã–π —à–∞–≥ –≤–∞–∂–µ–Ω üë£',
  '–¢–≤–æ—è —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª—ë–Ω–Ω–æ—Å—Ç—å ‚Äî —Å–∏–ª–∞ üí™',
  '–ë—É–¥—å —Å–≤–µ—Ç–æ–º –¥–ª—è –¥—Ä—É–≥–∏—Ö üí°',
  '–¢—ã –º–µ–Ω—è–µ—à—å –ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã üéÆ',
  '–ö–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç ‚Äî —à–∞–Ω—Å üéØ',
  '–¢–≤–æ—è –¥–æ–±—Ä–æ—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è üíñ',
  '–ù–µ —Å–æ–º–Ω–µ–≤–∞–π—Å—è –≤ —Å–µ–±–µ üíé',
  '–¢—ã ‚Äî –º–∞–≥–∏—è –≤ –¥–µ–π—Å—Ç–≤–∏–∏ ‚ú®',
  '–ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç–∞–∫—Ç ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å ü§ù',
  '–¢–≤–æ—è –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –æ–∫—É–ø–∏—Ç—Å—è üèÜ',
  '–ë—É–¥—å –ø—Ä–∏–º–µ—Ä–æ–º ‚Äî –Ω–µ –ø—Ä–æ–ø–æ–≤–µ–¥—å—é üåü',
  '–¢—ã —Å–æ–∑–¥–∞—ë—à—å –±—É–¥—É—â–µ–µ —Å–µ–≥–æ–¥–Ω—è üöÄ',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å —É—á–∏—Ç —á–µ–º—É-—Ç–æ –Ω–æ–≤–æ–º—É üìö',
  '–¢–≤–æ—è –∏–Ω—Ç—É–∏—Ü–∏—è ‚Äî –ø—É—Ç–µ–≤–æ–¥–∏—Ç–µ–ª—å üß≠',
  '–ü—Ä–æ–¥–æ–ª–∂–∞–π –º–µ—á—Ç–∞—Ç—å üí≠',
  '–¢—ã ‚Äî —á–∞—Å—Ç—å –±–æ–ª—å—à–æ–π –∏—Å—Ç–æ—Ä–∏–∏ üìñ',
  '–ö–∞–∂–¥—ã–π –≤—ã–±–æ—Ä —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—É—Ç—å üõ§Ô∏è',
  '–¢–≤–æ—è –≤–µ—Ä–∞ –¥–≤–∏–≥–∞–µ—Ç –≥–æ—Ä—ã ‚õ∞Ô∏è',
  '–ë—É–¥—å —Ö—Ä–∞–±—Ä–æ–π –≤ —Å–≤–æ–∏—Ö —Ä–µ—à–µ–Ω–∏—è—Ö ü¶ã',
  '–¢—ã ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —Å–≤–æ–µ–π —Å—É–¥—å–±—ã üèóÔ∏è',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ üåà',
  '–¢–≤–æ—è –ª—é–±–æ–≤—å –∫ –¥–µ–ª—É –≤–∏–¥–Ω–∞ üíï',
  '–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è –Ω–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ–º üöÄ',
  '–¢—ã ‚Äî –∑–≤–µ–∑–¥–∞ —Å–≤–æ–µ–≥–æ —à–æ—É ‚≠ê',
  '–ö–∞–∂–¥—ã–π —É—Å–ø–µ—Ö –∑–∞—Å–ª—É–∂–µ–Ω üèÖ',
  '–¢–≤–æ—è —á–µ—Å—Ç–Ω–æ—Å—Ç—å ‚Äî —Å–æ–∫—Ä–æ–≤–∏—â–µ üíé',
  '–ë—É–¥—å —Ç–µ—Ä–ø–µ–ª–∏–≤–∞ –∫ —Ä–æ—Å—Ç—É üå±',
  '–¢—ã –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—à—å –º–æ–ª—á–∞ üí´',
  '–ö–∞–∂–¥—ã–π —Ä–∞—Å—Å–≤–µ—Ç ‚Äî –Ω–∞–¥–µ–∂–¥–∞ üåÖ',
  '–¢–≤–æ—è —Å–∏–ª–∞ –≤ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ üíñ',
  '–ü—Ä–æ–¥–æ–ª–∂–∞–π —Å–∏—è—Ç—å üåü',
  '–¢—ã ‚Äî —Ä–µ–¥–∫–∏–π –±—Ä–∏–ª–ª–∏–∞–Ω—Ç üíé',
  '–ö–∞–∂–¥—ã–π –æ–ø—ã—Ç —Ü–µ–Ω–µ–Ω üìö',
  '–¢–≤–æ—è —É–ª—ã–±–∫–∞ –º–µ–Ω—è–µ—Ç –º–∏—Ä üòä',
  '–ë—É–¥—å –¥–æ–±—Ä–∞ –∫ —Å–µ–±–µ üß°',
  '–¢—ã ‚Äî –±–æ–ª—å—à–µ, —á–µ–º –¥—É–º–∞–µ—à—å üåå',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª—é–±–∏—Ç—å üíï',
  '–¢–≤–æ—è —â–µ–¥—Ä–æ—Å—Ç—å –≤–µ—Ä–Ω—ë—Ç—Å—è üéÅ',
  '–ù–µ –±–æ–π—Å—è –ø–∞–¥–∞—Ç—å ‚Äî –±–æ–π—Å—è –Ω–µ –≤—Å—Ç–∞—Ç—å üí™',
  '–¢—ã ‚Äî –≤–æ–∏–Ω —Å–≤–µ—Ç–∞ ‚öîÔ∏è',
  '–ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ ‚Äî —Ä–æ—Å—Ç üìà',
  '–¢–≤–æ—è –º—É–¥—Ä–æ—Å—Ç—å —Ä–∞—Å—Ç—ë—Ç ü¶â',
  '–ë—É–¥—å –æ—Ç–∫—Ä—ã—Ç–∞ —á—É–¥–µ—Å–∞–º ‚ú®',
  '–¢—ã —Å–æ–∑–¥–∞—ë—à—å –∏—Å—Ç–æ—Ä–∏—é üìñ',
  '–ö–∞–∂–¥—ã–π –∑–∞–∫–∞—Ç –æ–±–µ—â–∞–µ—Ç —Ä–∞—Å—Å–≤–µ—Ç üåÖ',
  '–¢–≤–æ—è –¥—É—à–∞ –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞ üíñ',
  '–ü—Ä–æ–¥–æ–ª–∂–∞–π –±—ã—Ç—å —Å–æ–±–æ–π ü¶ã',
  '–¢—ã ‚Äî –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ üí´',
  '–ö–∞–∂–¥—ã–π –º–∏–≥ –¥—Ä–∞–≥–æ—Ü–µ–Ω–µ–Ω ‚è∞',
  '–¢–≤–æ—è –≤–µ—Ä–∞ –Ω–µ–ø–æ–∫–æ–ª–µ–±–∏–º–∞ üôè',
  '–ë—É–¥—å —Å—á–∞—Å—Ç–ª–∏–≤–∞ —Å–µ–π—á–∞—Å üòä',
  '–¢—ã ‚Äî —á—É–¥–æ –ø—Ä–∏—Ä–æ–¥—ã üå∏',
  '–ö–∞–∂–¥—ã–π –¥—Ä—É–≥ ‚Äî –ø–æ–¥–∞—Ä–æ–∫ üéÅ',
  '–¢–≤–æ—è –ª—é–±–æ–≤—å –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω–∞ üíï',
  '–ù–µ –ø–µ—Ä–µ—Å—Ç–∞–≤–∞–π —É–¥–∏–≤–ª—è—Ç—å—Å—è üåà',
  '–¢—ã ‚Äî —Å–≤–µ—Ç –≤–æ —Ç—å–º–µ üí°',
  '–ö–∞–∂–¥—ã–π —É—Ä–æ–∫ –≤–µ–¥—ë—Ç –≤—ã—à–µ üìà',
  '–¢–≤–æ—è –Ω–∞–¥–µ–∂–¥–∞ –∑–∞—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞ üåü',
  '–ë—É–¥—å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–∞ –∑–∞ –≤—Å—ë üôè',
  '–¢—ã ‚Äî –æ—Ç–≤–µ—Ç –Ω–∞ —á—å—é-—Ç–æ –º–æ–ª–∏—Ç–≤—É üí´',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ üéÅ',
  '–¢–≤–æ—è –∂–∏–∑–Ω—å ‚Äî —à–µ–¥–µ–≤—Ä üé®',
  '–ü—Ä–æ–¥–æ–ª–∂–∞–π –ª—é–±–∏—Ç—å üíñ',
  '–¢—ã ‚Äî —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ ‚ú®',
  '–ö–∞–∂–¥—ã–π —à–∞–≥ ‚Äî —Ç–∞–Ω–µ—Ü üíÉ',
  '–¢–≤–æ—è —Ä–∞–¥–æ—Å—Ç—å ‚Äî –¥–∞—Ä üéÅ',
  '–ë—É–¥—å —Å–æ–±–æ–π ‚Äî —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üíé',
  '–¢—ã ‚Äî –ª—é–±–æ–≤—å –≤ –¥–µ–π—Å—Ç–≤–∏–∏ üíï',
  '–ö–∞–∂–¥—ã–π –≤–∑–¥–æ—Ö ‚Äî —á—É–¥–æ üå¨Ô∏è',
  '–¢–≤–æ—è –∂–∏–∑–Ω—å –∏–º–µ–µ—Ç —Å–º—ã—Å–ª üåü',
  '–ù–µ –ø–µ—Ä–µ—Å—Ç–∞–≤–∞–π –≤–µ—Ä–∏—Ç—å üôè',
  '–¢—ã ‚Äî –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞ üíñ',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –ø–æ–±–µ–¥–∞ –Ω–∞–¥ –≤—á–µ—Ä–∞ üèÜ',
  '–¢–≤–æ—è —Å–∏–ª–∞ –≤ —Ç–≤–æ–µ–π –∏—Å—Ç–æ—Ä–∏–∏ üìñ',
  '–ë—É–¥—å —Å–≤–µ—Ç–æ–º ‚Äî –º–∏—Ä –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —Ç–µ–±–µ üí°',
  '–¢—ã ‚Äî –∏–º–µ–Ω–Ω–æ —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–æ üéØ',
  '–ö–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –≤–µ—á–Ω–æ—Å—Ç—å ‚àû',
  '–¢–≤–æ—è –¥–æ–±—Ä–æ—Ç–∞ ‚Äî —Ç–≤–æ—è —Å—É–ø–µ—Ä—Å–∏–ª–∞ üí´',
  '–ü—Ä–æ–¥–æ–ª–∂–∞–π –∏–¥—Ç–∏ ‚Äî –¥–æ—Ä–æ–≥–∞ –ø–æ—è–≤–∏—Ç—Å—è üõ§Ô∏è',
  '–¢—ã ‚Äî —á–∞—Å—Ç—å —á—É–¥–∞ ‚ú®',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤—ã–π —à–∞–Ω—Å üåÖ',
  '–¢–≤–æ—è –ª—é–±–æ–≤—å –º–µ–Ω—è–µ—Ç –º–∏—Ä üåç',
  '–ë—É–¥—å —Å–º–µ–ª–æ–π ‚Äî —Ç—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å üí™',
  '–¢—ã ‚Äî –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–∞—è üåü',
  '–ö–∞–∂–¥—ã–π –º–∏–≥ ‚Äî –ø–æ–¥–∞—Ä–æ–∫ üéÅ',
  '–¢–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è üìñ',
  '–ù–µ —Å–¥–∞–≤–∞–π—Å—è ‚Äî —á—É–¥–æ —Ä—è–¥–æ–º ‚ú®',
  '–¢—ã ‚Äî –≤—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ üíé',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –ø—Ä–∞–∑–¥–Ω–∏–∫ –∂–∏–∑–Ω–∏ üéâ',
  '–¢–≤–æ—è —Å–∏–ª–∞ –≤ –ª—é–±–≤–∏ üíï',
  '–ë—É–¥—å —Å—á–∞—Å—Ç–ª–∏–≤–∞ ‚Äî —Ç—ã –∑–∞—Å–ª—É–∂–∏–ª–∞ üòä',
  '–¢—ã ‚Äî –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å ‚àû',
  '–ö–∞–∂–¥—ã–π —à–∞–≥ ‚Äî –∫ –º–µ—á—Ç–µ üë£',
  '–¢–≤–æ—è –≤–µ—Ä–∞ ‚Äî —Ç–≤–æ–π —â–∏—Ç üõ°Ô∏è',
  '–ü—Ä–æ–¥–æ–ª–∂–∞–π –ª—é–±–∏—Ç—å –∂–∏–∑–Ω—å üíñ',
  '–¢—ã ‚Äî —á—É–¥–æ üåü',
  '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî —Ç–≤–æ–π –¥–µ–Ω—å ‚òÄÔ∏è',
  '–¢–≤–æ—è –∂–∏–∑–Ω—å ‚Äî –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ üôè',
  '–ë—É–¥—å —Å–æ–±–æ–π ‚Äî –º–∏—Ä –∂–¥—ë—Ç —Ç–µ–±—è üåç',
  '–¢—ã ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∏ –Ω–µ–ø–æ–≤—Ç–æ—Ä–∏–º–∞—è üíé',
  '–ö–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç ‚Äî –≤–µ—á–Ω–æ—Å—Ç—å ‚àû',
  '–¢–≤–æ—è –ª—é–±–æ–≤—å ‚Äî —Ç–≤–æ—è —Å–∏–ª–∞ üí™',
  '–ù–µ –ø–µ—Ä–µ—Å—Ç–∞–≤–∞–π –º–µ—á—Ç–∞—Ç—å üí≠',
  '–¢—ã ‚Äî –∑–≤–µ–∑–¥–∞ üåü',
]

// –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–∏—Ç–∞—Ç—ã –¥–Ω—è (–æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –¥–ª—è –≤—Å–µ—Ö –ø–æ –¥–Ω—é –≥–æ–¥–∞)
const getDayOfYear = () => {
  const now = new Date()
  const start = new Date(now.getFullYear(), 0, 0)
  const diff = now.getTime() - start.getTime()
  const oneDay = 1000 * 60 * 60 * 24
  return Math.floor(diff / oneDay)
}

// –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
interface Notification {
  id: number
  type: string
  title: string
  text: string
  link?: string
  is_read: boolean
  created_at: string
}


// –¢–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞
interface Material {
  id: number
  title: string
  description?: string
  external_url?: string
  category_id?: number  // Deprecated
  category?: { name: string; slug: string; icon: string }  // Deprecated, –ø–µ—Ä–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
  category_ids?: number[]  // –ù–æ–≤–æ–µ: –º–∞—Å—Å–∏–≤ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  categories?: { id: number; name: string; slug: string; icon: string }[]  // –ù–æ–≤–æ–µ: –º–∞—Å—Å–∏–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  format?: string
  cover_image?: string
  is_published: boolean
  is_featured: boolean
  views: number
  created_at: string
  favorites_count?: number  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤
}

// –¢–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
interface Category {
  id: number
  name: string
  slug: string
  icon: string
  description?: string
  materials_count?: number
}

export default function LibraryPage() {
  const router = useRouter()
  const [loading, setLoading] = useState(true)
  const [user, setUser] = useState(defaultUser)
  const [isAdmin, setIsAdmin] = useState(false)
  
  // WebSocket –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  usePresence('library')
  const [activeCategory, setActiveCategoryState] = useState('all')
  
  // –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const setActiveCategory = (category: string) => {
    setActiveCategoryState(category)
    setVisibleCount(8) // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
  }
  const [showNotifications, setShowNotifications] = useState(false)
  const [showProfileMenu, setShowProfileMenu] = useState(false)
  const [notifications, setNotifications] = useState<Notification[]>([])
  const [quoteIndex, setQuoteIndex] = useState(getDayOfYear() % dailyQuotes.length)
  const [isQuoteAnimating, setIsQuoteAnimating] = useState(false)
  
  // –°–∫—Ä–æ–ª–ª –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞ –º–µ–Ω—é
  const [showHeader, setShowHeader] = useState(true)
  const [showMobileNav, setShowMobileNav] = useState(true)
  const [lastScrollY, setLastScrollY] = useState(0)
  
  // –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API
  const [materials, setMaterials] = useState<Material[]>([])
  const [apiCategories, setApiCategories] = useState<Category[]>([])
  const [favoriteIds, setFavoriteIds] = useState<Set<number>>(new Set())
  const [searchQuery, setSearchQuery] = useState('')
  
  // –ü–∞–≥–∏–Ω–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (4 –Ω–∞ –º–æ–±–∏–ª–∫–µ, 8 –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ)
  const [visibleCount, setVisibleCount] = useState(4) // –ù–∞—á–∏–Ω–∞–µ–º —Å 4 (–º–æ–±–∏–ª–∫–∞)
  const [isMobile, setIsMobile] = useState(true)
  const [isPWA, setIsPWA] = useState(false)
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ PWA –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
  useEffect(() => {
    const checkMobile = () => {
      const mobile = window.innerWidth < 768
      setIsMobile(mobile)
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
      if (visibleCount === 4 && !mobile) {
        setVisibleCount(8)
      }
    }
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º PWA —Ä–µ–∂–∏–º
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
                         (window.navigator as unknown as { standalone?: boolean }).standalone === true
    setIsPWA(isStandalone)
    
    checkMobile()
    window.addEventListener('resize', checkMobile)
    return () => window.removeEventListener('resize', checkMobile)
  }, [])
  
  const ITEMS_PER_PAGE = isMobile ? 4 : 8

  // –û–±–Ω–æ–≤–∏—Ç—å —Ü–∏—Ç–∞—Ç—É (—Å–ª—É—á–∞–π–Ω–∞—è) —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
  const refreshQuote = () => {
    if (isQuoteAnimating) return
    
    setIsQuoteAnimating(true)
    
    setTimeout(() => {
      let newIndex
      do {
        newIndex = Math.floor(Math.random() * dailyQuotes.length)
      } while (newIndex === quoteIndex)
      setQuoteIndex(newIndex)
      
      setTimeout(() => {
        setIsQuoteAnimating(false)
      }, 300)
    }, 300)
  }

  // –ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  const markAllAsRead = async () => {
    try {
      await api.post('/materials/notifications/read-all')
      setNotifications(notifications.map(n => ({ ...n, is_read: true })))
      setUser(prev => ({ ...prev, notifications: 0 }))
    } catch (error) {
      console.error('Error marking all as read:', error)
    }
  }

  // –ü—Ä–æ—á–∏—Ç–∞—Ç—å –æ–¥–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  const markAsRead = async (id: number) => {
    try {
      await api.post(`/materials/notifications/${id}/read`)
      setNotifications(notifications.map(n => 
        n.id === id ? { ...n, is_read: true } : n
      ))
      const unreadCount = notifications.filter(n => !n.is_read && n.id !== id).length
      setUser(prev => ({ ...prev, notifications: unreadCount }))
    } catch (error) {
      console.error('Error marking as read:', error)
    }
  }

  // –û—Ç–∫—Ä—ã—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –∏ –∑–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä
  const openMaterial = (material: Material) => {
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ —á–µ—Ä–µ–∑ —Å–æ–∑–¥–∞–Ω–∏–µ <a> —ç–ª–µ–º–µ–Ω—Ç–∞
    if (material.external_url) {
      const link = document.createElement('a')
      link.href = material.external_url
      link.target = '_blank'
      link.rel = 'noopener noreferrer'
      document.body.appendChild(link)
      link.click()
      document.body.removeChild(link)
    }
    
    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
    api.post(`/materials/${material.id}/view`)
      .then(() => {
        setUser(prev => ({ ...prev, materialsViewed: prev.materialsViewed + 1 }))
      })
      .catch(error => {
        console.error('Error recording view:', error)
      })
  }

  // –î–æ–±–∞–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
  const toggleFavorite = async (materialId: number) => {
    const isFavorite = favoriteIds.has(materialId)
    
    try {
      if (isFavorite) {
        await api.delete(`/materials/${materialId}/favorite`)
        setFavoriteIds(prev => {
          const newSet = new Set(prev)
          newSet.delete(materialId)
          setUser(u => ({ ...u, favorites: newSet.size }))
          return newSet
        })
        // –£–º–µ–Ω—å—à–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –ª–∞–π–∫–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ
        setMaterials(prev => prev.map(m => 
          m.id === materialId ? { ...m, favorites_count: Math.max(0, (m.favorites_count ?? 1) - 1) } : m
        ))
      } else {
        await api.post(`/materials/${materialId}/favorite`)
        setFavoriteIds(prev => {
          const newSet = new Set(prev).add(materialId)
          setUser(u => ({ ...u, favorites: newSet.size }))
          return newSet
        })
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –ª–∞–π–∫–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ
        setMaterials(prev => prev.map(m => 
          m.id === materialId ? { ...m, favorites_count: (m.favorites_count ?? 0) + 1 } : m
        ))
      }
    } catch (error) {
      console.error('Error toggling favorite:', error)
    }
  }

  useEffect(() => {
    const loadUserData = async () => {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
      const token = localStorage.getItem('access_token')
      if (!token) {
        router.push('/login')
        return
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ API
      try {
        const meResponse = await api.get('/auth/me')
        const userData = meResponse.data
        setUser(prev => ({
          ...prev,
          name: userData.first_name || '–ì–æ—Å—Ç—å',
          avatar: userData.photo_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${userData.username || userData.first_name}&backgroundColor=ffdfbf`,
          loyaltyLevel: userData.loyalty_level || 'none',
        }))
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–º–∏–Ω–∞
        if (ADMIN_IDS.includes(userData.telegram_id)) {
          setIsAdmin(true)
        }
        // –û–±–Ω–æ–≤–ª—è–µ–º localStorage
        localStorage.setItem('user', JSON.stringify(userData))
      } catch {
        // Fallback –Ω–∞ localStorage
        const savedUser = localStorage.getItem('user')
        if (savedUser) {
          try {
            const userData = JSON.parse(savedUser)
            setUser(prev => ({
              ...prev,
              name: userData.first_name || '–ì–æ—Å—Ç—å',
              avatar: userData.photo_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${userData.username || userData.first_name}&backgroundColor=ffdfbf`,
              loyaltyLevel: userData.loyalty_level || 'none',
            }))
          } catch (err) {
            console.error('Error parsing user data:', err)
          }
        }
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∏–∑ API
      try {
        const response = await api.get('/auth/check-subscription')
        const subData = response.data
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞
        if (!subData.has_active_subscription) {
          // –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞ ‚Äî –∫–∏–∫–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
          localStorage.removeItem('access_token')
          localStorage.removeItem('user')
          alert('–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞. –ü—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ @momsclubsubscribe_bot')
          router.push('/login')
          return
        }
        
        setUser(prev => ({
          ...prev,
          subscriptionDaysLeft: subData.days_left || 0,
        }))
      } catch (error) {
        console.error('Error loading subscription:', error)
        // –ü—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Äî –∫–∏–∫–∞–µ–º
        localStorage.removeItem('access_token')
        localStorage.removeItem('user')
        router.push('/login')
        return
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      try {
        const catResponse = await api.get('/categories')
        setApiCategories(catResponse.data)
      } catch (error) {
        console.error('Error loading categories:', error)
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
      try {
        const matResponse = await api.get('/materials')
        const items = matResponse.data.items || []
        setMaterials(items)
        setUser(prev => ({
          ...prev,
          totalMaterials: matResponse.data.total || items.length,
        }))
      } catch (error) {
        console.error('Error loading materials:', error)
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–±—Ä–∞–Ω–Ω—ã–µ ID –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ —Å–µ—Ä–¥–µ—á–µ–∫ –ò —Å—á—ë—Ç—á–∏–∫
      try {
        const favResponse = await api.get('/materials/favorites/my')
        const favIds = new Set<number>((favResponse.data || []).map((m: Material) => m.id))
        setFavoriteIds(favIds)
        setUser(prev => ({ ...prev, favorites: favIds.size }))
      } catch (error) {
        console.error('Error loading favorites:', error)
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
      try {
        const statsResponse = await api.get('/materials/stats/my')
        setUser(prev => ({ 
          ...prev, 
          materialsViewed: statsResponse.data.materials_viewed || 0,
          uniqueViewed: statsResponse.data.unique_viewed || 0,
        }))
      } catch (error) {
        console.error('Error loading stats:', error)
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      try {
        const notifResponse = await api.get('/materials/notifications/my')
        setNotifications(notifResponse.data.notifications || [])
        setUser(prev => ({ ...prev, notifications: notifResponse.data.unread_count || 0 }))
      } catch (error) {
        console.error('Error loading notifications:', error)
      }

      setLoading(false)
    }

    loadUserData()
  }, [router])

  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞ –º–µ–Ω—é
  useEffect(() => {
    const handleScroll = () => {
      const currentScrollY = window.scrollY
      const scrollDiff = currentScrollY - lastScrollY
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –µ—Å–ª–∏ —Å–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –∏–ª–∏ –≤ —Å–∞–º–æ–º –≤–µ—Ä—Ö—É
      if (currentScrollY < 50) {
        setShowHeader(true)
        setShowMobileNav(true)
      } else if (scrollDiff > 10) {
        // –°–∫—Ä–æ–ª–ª–∏–º –≤–Ω–∏–∑ ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º
        setShowHeader(false)
        setShowMobileNav(false)
      } else if (scrollDiff < -10) {
        // –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
        setShowHeader(true)
        setShowMobileNav(true)
      }
      
      setLastScrollY(currentScrollY)
    }

    window.addEventListener('scroll', handleScroll, { passive: true })
    return () => window.removeEventListener('scroll', handleScroll)
  }, [lastScrollY])

  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-b from-[#FDFCFA] via-[#FBF8F3] to-[#F5EFE6] flex flex-col items-center justify-center">
        <img 
          src="/logolibrary.svg" 
          alt="LibriMomsClub" 
          className="h-20 sm:h-24 w-auto mb-4 animate-pulse"
        />
        <p className="text-[#8B8279] text-sm">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-[#FDFCFA] via-[#FBF8F3] to-[#F5EFE6] relative">
      {/* Premium gradient orbs */}
      <div className="fixed -top-40 -right-40 w-[600px] h-[600px] bg-gradient-to-br from-[#E8D5C4]/30 via-[#D4C4B0]/15 to-transparent rounded-full blur-3xl pointer-events-none"></div>
      <div className="fixed -bottom-40 -left-40 w-[500px] h-[500px] bg-gradient-to-tr from-[#C9B89A]/15 to-transparent rounded-full blur-3xl pointer-events-none"></div>

      {/* Header —Å –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π */}
      <header 
        className={`fixed top-0 left-0 right-0 z-50 border-b border-white/50 shadow-lg transition-transform duration-300 ease-in-out ${showHeader ? 'translate-y-0' : '-translate-y-full'}`} 
        style={{ background: 'rgba(255,255,255,0.55)', backdropFilter: 'blur(20px) saturate(180%)', paddingTop: 'env(safe-area-inset-top)' }}
      >
        <div className="max-w-7xl mx-auto px-6 py-2">
          <div className="flex items-center justify-between">
            <a href="/library" className="flex items-center space-x-2 group relative">
              <span className="text-2xl absolute -top-1 -left-2 rotate-[-15deg] drop-shadow-md">üéÖ</span>
              <img 
                src="/logolibrary.svg" 
                alt="LibriMomsClub" 
                className="h-8 w-auto group-hover:scale-105 transition-transform ml-5"
              />
            </a>
            
            <nav className="hidden md:flex space-x-8">
              <a href="/library" className="text-[#B08968] font-semibold">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</a>
              <a href="/favorites" className="text-[#8B8279] hover:text-[#B08968] transition-colors">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
              <a href="/history" className="text-[#8B8279] hover:text-[#B08968] transition-colors">–ò—Å—Ç–æ—Ä–∏—è</a>
            </nav>
            
            <div className="flex items-center space-x-4">
              {/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */}
              <div className="relative">
                <button 
                  onClick={() => setShowNotifications(!showNotifications)}
                  className="relative p-2 hover:bg-[#F5E6D3]/50 rounded-xl transition-colors"
                >
                  <span className="text-xl">üîî</span>
                  {user.notifications > 0 && (
                    <span className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center animate-pulse">
                      {user.notifications}
                    </span>
                  )}
                </button>
                
                {/* Overlay –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è dropdown */}
                {showNotifications && (
                  <div 
                    className="fixed inset-0 z-40 bg-black/5" 
                    onClick={() => setShowNotifications(false)}
                  />
                )}
                
                {/* Dropdown —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */}
                {showNotifications && (
                  <div 
                    className="absolute right-0 top-12 w-80 bg-white rounded-2xl shadow-2xl border border-[#E8D4BA]/40 z-50 overflow-hidden"
                  >
                      {/* Header */}
                      <div className="px-4 py-3 border-b border-[#E8D4BA]/30 flex items-center justify-between">
                        <span className="font-bold text-[#2D2A26]">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                        <button 
                          onClick={markAllAsRead}
                          className="text-xs text-[#B08968] hover:text-[#8B7355] font-medium"
                        >
                          –ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ
                        </button>
                      </div>
                      
                      {/* Notifications list */}
                      <div className="max-h-80 overflow-y-auto">
                        {notifications.length === 0 ? (
                          <div className="px-4 py-8 text-center text-[#8B8279]">
                            <span className="text-3xl mb-2 block">‚ú®</span>
                            –ù–µ—Ç –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                          </div>
                        ) : (
                          notifications.map((notif) => (
                            <div 
                              key={notif.id}
                              onClick={() => markAsRead(notif.id)}
                              className={`px-4 py-3 border-b border-[#E8D4BA]/20 hover:bg-[#FBF8F3] cursor-pointer transition-colors ${
                                !notif.is_read ? 'bg-[#F5E6D3]/20' : ''
                              }`}
                            >
                              <div className="flex items-start space-x-3">
                                <div className={`w-2 h-2 rounded-full mt-2 flex-shrink-0 ${
                                  !notif.is_read ? 'bg-[#B08968]' : 'bg-gray-300'
                                }`}></div>
                                <div className="flex-1">
                                  <p className="font-semibold text-sm text-[#2D2A26]">{notif.title}</p>
                                  <p className="text-sm text-[#5C5650]">{notif.text}</p>
                                  <p className="text-xs text-[#8B8279] mt-1">
                                    {new Date(notif.created_at).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' })}
                                  </p>
                                </div>
                              </div>
                            </div>
                          ))
                        )}
                      </div>
                      
                      {/* Footer */}
                      <div className="px-4 py-3 border-t border-[#E8D4BA]/30 text-center">
                        <button 
                          onClick={() => setShowNotifications(false)}
                          className="text-sm text-[#B08968] hover:text-[#8B7355] font-medium"
                        >
                          –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                      </div>
                    </div>
                )}
              </div>
              
              {/* –ê–≤–∞—Ç–∞—Ä —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º –º–µ–Ω—é */}
              <div className="relative">
                <button
                  onClick={() => setShowProfileMenu(!showProfileMenu)}
                  className="flex items-center space-x-2"
                >
                  <img 
                    src={user.avatar || ''} 
                    alt={user.name}
                    className="w-9 h-9 rounded-full border-2 border-[#E8D4BA] object-cover cursor-pointer hover:border-[#B08968] transition-colors"
                  />
                  <span className="text-[#8B8279] text-sm font-medium hidden md:block">
                    –í—ã–π—Ç–∏
                  </span>
                </button>
                
                {/* –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è */}
                {showProfileMenu && (
                  <div className="absolute right-0 top-12 bg-white rounded-xl shadow-xl border border-[#E8D4BA]/50 py-2 min-w-[160px] z-50">
                    <div className="px-4 py-2 border-b border-gray-100">
                      <p className="text-sm font-medium text-[#2D2A26]">{user.name}</p>
                      <p className="text-xs text-[#8B8279]">@{localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user') || '{}').username : ''}</p>
                    </div>
                    {isAdmin && (
                      <Link 
                        href="/admin"
                        className="w-full px-4 py-2 text-left text-sm text-[#B08968] hover:bg-[#F5E6D3] transition-colors flex items-center gap-2"
                      >
                        <span>‚öôÔ∏è</span> –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                      </Link>
                    )}
                    <button 
                      onClick={() => {
                        localStorage.removeItem('access_token')
                        localStorage.removeItem('user')
                        sessionStorage.removeItem('auth_error')
                        router.push('/login')
                      }}
                      className="w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 transition-colors flex items-center gap-2"
                    >
                      <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                      </svg>
                      –í—ã–π—Ç–∏
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      </header>

      {/* Main Content ‚Äî —Å –æ—Ç—Å—Ç—É–ø–æ–º –ø–æ–¥ fixed header */}
      <main className="max-w-7xl mx-auto px-4 py-8" style={{ paddingTop: 'calc(5rem + env(safe-area-inset-top, 0px))' }}>
        {/* –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –ü—Ä–æ—Ñ–∏–ª—å */}
        <div className="mb-10 grid lg:grid-cols-3 gap-6">
          {/* –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ */}
          <div className="lg:col-span-2 relative">
            <div className="absolute inset-0 bg-gradient-to-r from-[#C9A882]/10 to-[#B08968]/5 rounded-3xl blur-2xl"></div>
            <div className="relative bg-white/80 backdrop-blur-sm rounded-3xl p-6 lg:p-8 border border-[#E8D4BA]/40 shadow-xl shadow-[#C9A882]/10 h-full">
              <div className="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                <div className="flex-1">
                  <h2 className="text-xl lg:text-2xl font-bold text-[#2D2A26] mb-2">
                    üëã –ü—Ä–∏–≤–µ—Ç, {user.name}!
                  </h2>
                  <p className="text-[#5C5650] text-sm lg:text-base mb-4">
                    –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –∏–¥–µ–∏ –¥–ª—è Reels, –≥–∞–π–¥—ã –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–æ—Å—Ç–∞
                  </p>
                  
                  {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}
                  <div className="flex items-center gap-4 text-sm">
                    <div className="flex items-center space-x-1">
                      <span>üëÅÔ∏è</span>
                      <span><strong>{user.materialsViewed}</strong> –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ</span>
                    </div>
                    <div className="flex items-center space-x-1">
                      <span>‚≠ê</span>
                      <span><strong>{user.favorites}</strong> –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º</span>
                    </div>
                  </div>
                  
                  {/* –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–∑—É—á–µ–Ω–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –º–æ–±–∏–ª—å–Ω—ã–π */}
                  <div className="lg:hidden mt-4 bg-[#F5E6D3]/50 rounded-xl p-3">
                    <div className="flex items-center justify-between mb-1.5">
                      <span className="text-xs font-medium text-[#8B8279]">üìö –ò–∑—É—á–µ–Ω–æ</span>
                      <span className="text-xs font-bold text-[#B08968]">{user.uniqueViewed} –∏–∑ {user.totalMaterials || 0}</span>
                    </div>
                    <div className="h-2 bg-white rounded-full overflow-hidden">
                      <div 
                        className="h-full bg-gradient-to-r from-[#B08968] to-[#C9A882] rounded-full"
                        style={{ width: `${user.totalMaterials > 0 ? Math.min((user.uniqueViewed / user.totalMaterials) * 100, 100) : 0}%` }}
                      ></div>
                    </div>
                  </div>
                </div>
                
                {/* –°—Ç–∞—Ç—É—Å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ */}
                <div className={`flex items-center space-x-2 px-3 py-1.5 rounded-full whitespace-nowrap text-sm ${loyaltyBadges[user.loyaltyLevel as keyof typeof loyaltyBadges].color}`}>
                  <span>–°—Ç–∞—Ç—É—Å:</span>
                  <span>{loyaltyBadges[user.loyaltyLevel as keyof typeof loyaltyBadges].icon}</span>
                  <span className="font-bold">{loyaltyBadges[user.loyaltyLevel as keyof typeof loyaltyBadges].label}</span>
                </div>
              </div>
            </div>
          </div>
          
          {/* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ */}
          <div className="relative">
            <div className="absolute inset-0 bg-gradient-to-br from-[#B08968]/10 to-[#C9A882]/5 rounded-3xl blur-xl"></div>
            <div className="relative bg-white/90 backdrop-blur-sm rounded-3xl p-6 border border-[#E8D4BA]/40 shadow-xl shadow-[#C9A882]/10 h-full">
              <div className="flex items-center justify-between mb-4">
                <span className="text-sm font-medium text-[#8B8279]">–ü–æ–¥–ø–∏—Å–∫–∞</span>
                {user.subscriptionDaysLeft <= 7 && (
                  <span className="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full font-medium animate-pulse">
                    ‚ö†Ô∏è –°–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞–µ—Ç
                  </span>
                )}
              </div>
              
              <div className="text-center mb-4">
                <div className="text-5xl font-black text-[#2D2A26]">
                  {user.subscriptionDaysLeft > 365 ? '‚àû' : user.subscriptionDaysLeft}
                </div>
                <div className="text-sm text-[#8B8279]">
                  {user.subscriptionDaysLeft > 365 ? '–±–µ–∑–ª–∏–º–∏—Ç' : '–¥–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å'}
                </div>
              </div>
              
              {/* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */}
              <div className="mb-4">
                <div className="h-2 bg-[#F5E6D3] rounded-full overflow-hidden">
                  <div 
                    className="h-full bg-gradient-to-r from-[#B08968] to-[#C9A882] rounded-full transition-all duration-500"
                    style={{ width: `${Math.min((user.subscriptionDaysLeft / user.subscriptionTotal) * 100, 100)}%` }}
                  ></div>
                </div>
              </div>
              
              <a 
                href="https://t.me/momsclubsubscribe_bot?start=renew" 
                target="_blank"
                className="block w-full text-center py-3 bg-gradient-to-r from-[#B08968] to-[#A67C52] text-white font-semibold rounded-xl hover:shadow-lg transition-all duration-300 text-sm"
              >
                –ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
              </a>
            </div>
          </div>
        </div>

        {/* –¶–∏—Ç–∞—Ç–∞ –¥–Ω—è */}
        <div className="mb-8 bg-gradient-to-r from-[#F5E6D3]/50 to-[#ECD9C8]/30 rounded-2xl p-4 lg:p-6 border border-[#E8D4BA]/30">
          <div className="flex items-start justify-between gap-4">
            <div className="flex items-start space-x-3 flex-1">
              <span className="text-2xl lg:text-3xl">üí¨</span>
              <div 
                className={`transition-all duration-300 ${isQuoteAnimating ? 'opacity-0 translate-y-2' : 'opacity-100 translate-y-0'}`}
              >
                <p className="text-[#2D2A26] font-medium italic text-sm lg:text-base">&ldquo;{dailyQuotes[quoteIndex]}&rdquo;</p>
                <p className="text-[#B08968] text-xs lg:text-sm mt-2">‚Äî –ü–æ–ª–∏–Ω–∞</p>
              </div>
            </div>
            <button 
              onClick={refreshQuote}
              disabled={isQuoteAnimating}
              className={`flex items-center space-x-2 px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-300 flex-shrink-0 ${
                isQuoteAnimating 
                  ? 'bg-[#E8D4BA]/50 text-[#8B8279] cursor-not-allowed' 
                  : 'bg-white/70 hover:bg-white text-[#B08968] hover:shadow-md border border-[#E8D4BA]/50'
              }`}
            >
              <span className={`transition-transform duration-300 ${isQuoteAnimating ? 'animate-spin' : ''}`}>‚ú®</span>
              <span className="hidden sm:inline">–ù–æ–≤–∞—è —Ü–∏—Ç–∞—Ç–∞</span>
            </button>
          </div>
        </div>

        {/* ‚≠ê –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å–µ–∫—Ü–∏—è "–í—ã–±–æ—Ä –ü–æ–ª–∏–Ω—ã" */}
        {materials.filter(m => m.is_featured).length > 0 && (
          <div className="mb-6">
            <h3 className="text-lg font-bold text-[#2D2A26] flex items-center gap-2 mb-3">
              <span>‚≠ê</span> –í—ã–±–æ—Ä –ü–æ–ª–∏–Ω—ã
            </h3>
            <div className="flex gap-3 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide">
              {materials.filter(m => m.is_featured).map((material) => (
                <div 
                  key={material.id}
                  onClick={() => openMaterial(material)}
                  className="flex-shrink-0 w-40 bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-3 border border-amber-200/50 hover:shadow-lg hover:-translate-y-0.5 transition-all cursor-pointer"
                >
                  {material.cover_image ? (
                    <img src={material.cover_image} alt={material.title} className="w-full h-20 object-cover rounded-lg mb-2" />
                  ) : (
                    <div className="w-full h-20 bg-gradient-to-br from-amber-200 to-amber-300 rounded-lg mb-2 flex items-center justify-center text-2xl">
                      {material.categories?.[0]?.icon || material.category?.icon || '‚≠ê'}
                    </div>
                  )}
                  <h4 className="font-medium text-[#2D2A26] text-xs line-clamp-2 leading-tight">{material.title}</h4>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* –§–∏–ª—å—Ç—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π ‚Äî —Ä–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞ 4 –∫–æ–ª–æ–Ω–∫–∏ */}
        <div className="mb-10">
          <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
            {/* –ö–Ω–æ–ø–∫–∞ "–í—Å–µ" */}
            <button
              onClick={() => setActiveCategory('all')}
              className={`flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 ${
                activeCategory === 'all'
                  ? 'bg-gradient-to-r from-[#B08968] to-[#A67C52] text-white shadow-lg shadow-[#B08968]/25 scale-[1.02]'
                  : 'bg-white/90 text-[#5C5650] hover:bg-[#F5E6D3] border border-[#E8D4BA]/40 hover:border-[#B08968]/50 hover:shadow-md'
              }`}
            >
              <span className="text-lg">üìö</span>
              <span>–í—Å–µ</span>
            </button>
            
            {/* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ API */}
            {apiCategories.map((cat, index) => {
              // –ü–æ—Å–ª–µ–¥–Ω—è—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–ë—Ä–µ–Ω–¥—ã –∏ —Å–æ—Ç—Ä.) –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É –Ω–∞ –º–æ–±–∏–ª–∫–µ
              const isLast = index === apiCategories.length - 1
              
              return (
                <button
                  key={cat.id}
                  onClick={() => setActiveCategory(cat.slug)}
                  className={`flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 ${
                    isLast ? 'col-span-2 md:col-span-4' : ''
                  } ${
                    activeCategory === cat.slug
                      ? 'bg-gradient-to-r from-[#B08968] to-[#A67C52] text-white shadow-lg shadow-[#B08968]/25 scale-[1.02]'
                      : 'bg-white/90 text-[#5C5650] hover:bg-[#F5E6D3] border border-[#E8D4BA]/40 hover:border-[#B08968]/50 hover:shadow-md'
                  }`}
                >
                  <span className="text-lg">{cat.icon}</span>
                  <span className="truncate">{cat.name}</span>
                </button>
              )
            })}
            
            {/* –§–∏–ª—å—Ç—Ä "–í—ã–±–æ—Ä –ü–æ–ª–∏–Ω—ã" ‚Äî –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */}
            <button
              onClick={() => setActiveCategory('featured')}
              className={`col-span-2 md:col-span-4 flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 ${
                activeCategory === 'featured'
                  ? 'bg-gradient-to-r from-amber-400 to-amber-500 text-white shadow-lg shadow-amber-400/25 scale-[1.01]'
                  : 'bg-gradient-to-r from-amber-50 to-orange-50 text-amber-700 border border-amber-200/60 hover:border-amber-400/50 hover:shadow-md'
              }`}
            >
              <span className="text-lg">‚≠ê</span>
              <span>–í—ã–±–æ—Ä –ü–æ–ª–∏–Ω—ã</span>
              <span className="text-xs opacity-70">({materials.filter(m => m.is_featured).length})</span>
            </button>
          </div>
        </div>

        {/* üîç –ü–æ–∏—Å–∫ + –ü—Ä–æ–≥—Ä–µ—Å—Å */}
        <div className="mb-6 grid lg:grid-cols-4 gap-4">
          {/* –ü–æ–∏—Å–∫ */}
          <div className="lg:col-span-3 relative">
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="üîç –ü–æ–∏—Å–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤..."
              className="w-full px-5 py-3 lg:px-6 lg:py-4 rounded-xl lg:rounded-2xl bg-white/90 border border-[#E8D4BA]/40 focus:border-[#B08968] focus:outline-none focus:ring-2 focus:ring-[#B08968]/20 text-[#2D2A26] placeholder-[#A09890] shadow-lg shadow-[#C9A882]/5 transition-all"
            />
            {searchQuery && (
              <button 
                onClick={() => setSearchQuery('')}
                className="absolute right-3 lg:right-4 top-1/2 -translate-y-1/2 text-[#8B8279] hover:text-[#B08968] text-lg"
              >
                ‚úï
              </button>
            )}
          </div>
          
          {/* –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–∑—É—á–µ–Ω–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –¥–µ—Å–∫—Ç–æ–ø */}
          <div className="hidden lg:block bg-white/90 rounded-2xl p-4 border border-[#E8D4BA]/40 shadow-lg shadow-[#C9A882]/5">
            <div className="flex items-center justify-between mb-2">
              <span className="text-xs font-medium text-[#8B8279]">üìö –ò–∑—É—á–µ–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</span>
              <span className="text-xs font-bold text-[#B08968]">{user.totalMaterials > 0 ? Math.round((user.uniqueViewed / user.totalMaterials) * 100) : 0}%</span>
            </div>
            <div className="h-2 bg-[#F5E6D3] rounded-full overflow-hidden">
              <div 
                className="h-full bg-gradient-to-r from-[#B08968] to-[#C9A882] rounded-full transition-all duration-500"
                style={{ width: `${user.totalMaterials > 0 ? Math.min((user.uniqueViewed / user.totalMaterials) * 100, 100) : 0}%` }}
              ></div>
            </div>
            <div className="text-xs text-[#8B8279] mt-1">{user.uniqueViewed} –∏–∑ {user.totalMaterials || 0}</div>
          </div>
        </div>
        
        {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ */}
        {searchQuery && (
          <p className="text-sm text-[#8B8279] mb-4 -mt-2">
            üîç –ù–∞–π–¥–µ–Ω–æ: {materials.filter(m => 
              m.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
              m.description?.toLowerCase().includes(searchQuery.toLowerCase())
            ).length} –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
          </p>
        )}

        {/* ÔøΩÔøΩ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã */}
        <section className="mb-12">
          {(() => {
            const filteredMaterials = materials
              .filter(m => {
                if (activeCategory === 'all') return true
                if (activeCategory === 'featured') return m.is_featured
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ categories –∏–ª–∏ —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ category
                if (m.categories?.length) {
                  return m.categories.some(c => c.slug === activeCategory)
                }
                return m.category?.slug === activeCategory
              })
              .filter(m => {
                if (!searchQuery.trim()) return true
                const query = searchQuery.toLowerCase()
                const categoryNames = m.categories?.map(c => c.name.toLowerCase()).join(' ') || m.category?.name.toLowerCase() || ''
                return (
                  m.title.toLowerCase().includes(query) ||
                  m.description?.toLowerCase().includes(query) ||
                  categoryNames.includes(query)
                )
              })
            
            return (
              <>
                <div className="flex items-center justify-between mb-6">
                  <div className="flex items-center space-x-3">
                    <h3 className="text-2xl font-bold text-[#2D2A26]">
                      {searchQuery ? 'üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞' : 'üìö –ú–∞—Ç–µ—Ä–∏–∞–ª—ã'}
                    </h3>
                    <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-semibold">
                      {filteredMaterials.length} —à—Ç.
                    </span>
                  </div>
                </div>
                
                {filteredMaterials.length === 0 ? (
                  <div className="text-center py-12 bg-white/80 rounded-2xl border border-[#E8D4BA]/40">
                    <div className="text-4xl mb-4">{searchQuery ? 'üîç' : 'üì≠'}</div>
                    <p className="text-[#8B8279] mb-2">
                      {searchQuery ? `–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É "${searchQuery}"` : '–ü–æ–∫–∞ –Ω–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤'}
                    </p>
                    {searchQuery && (
                      <button 
                        onClick={() => setSearchQuery('')}
                        className="text-[#B08968] hover:underline text-sm"
                      >
                        –°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∏—Å–∫
                      </button>
                    )}
                  </div>
                ) : (
                  <>
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                      {filteredMaterials.slice(0, visibleCount).map((material, index) => (
                        <div 
                          key={material.id} 
                          className="group bg-white/90 rounded-2xl shadow-lg shadow-[#C9A882]/10 hover:shadow-xl hover:shadow-[#C9A882]/20 transition-all duration-500 p-5 cursor-pointer border border-[#E8D4BA]/40 hover:-translate-y-1 relative overflow-hidden animate-fadeIn"
                          style={{ animationDelay: `${(index % ITEMS_PER_PAGE) * 80}ms` }}
                        >
                          {/* –ë–µ–π–¥–∂–∏ */}
                          <div className="absolute top-3 right-3 flex gap-1.5 z-10">
                            {material.is_featured && (
                              <div className="bg-gradient-to-r from-amber-400 to-amber-500 text-white text-xs font-bold px-2 py-1 rounded-lg shadow-md">
                                ‚≠ê –í—ã–±–æ—Ä –ü–æ–ª–∏–Ω—ã
                              </div>
                            )}
                            {new Date(material.created_at) > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000) && (
                              <div className="bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-lg">NEW</div>
                            )}
                          </div>
                          <button
                            onClick={(e) => { e.stopPropagation(); toggleFavorite(material.id) }}
                            className={`absolute bottom-2 right-2 z-20 w-8 h-8 rounded-full flex items-center justify-center transition-all shadow-md ${favoriteIds.has(material.id) ? 'bg-red-500 text-white' : 'bg-white/90 text-gray-400 hover:bg-red-100 hover:text-red-500'}`}
                          >
                            <span className="text-base">{favoriteIds.has(material.id) ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                          </button>
                          <div onClick={() => openMaterial(material)}>
                            {material.cover_image ? (
                              <img src={material.cover_image} alt={material.title} className="w-full h-24 object-cover rounded-xl mb-3" />
                            ) : (
                              <div className="w-full h-24 bg-gradient-to-br from-[#C9A882] to-[#B08968] rounded-xl mb-3 flex items-center justify-center text-3xl">{material.categories?.[0]?.icon || material.category?.icon || 'üìÑ'}</div>
                            )}
                            <span className="text-xs bg-[#F5E6D3] text-[#8B7355] px-2 py-1 rounded-full font-medium">
                              {material.categories?.length ? material.categories.map(c => c.name).join(' ‚Ä¢ ') : (material.category?.name || material.format || '–ú–∞—Ç–µ—Ä–∏–∞–ª')}
                            </span>
                            <h4 className="font-semibold text-[#2D2A26] mt-2 text-sm leading-tight line-clamp-2">{material.title}</h4>
                            {material.description && <p className="text-xs text-[#8B8279] mt-1 line-clamp-2">{material.description}</p>}
                            <div className="text-xs text-[#8B8279] mt-2 flex items-center gap-3">
                              <span className="flex items-center gap-1">
                                <span>üëÅÔ∏è</span>
                                <span>{material.views}</span>
                              </span>
                              {(material.favorites_count ?? 0) > 0 && (
                                <span className="flex items-center gap-1 text-[#B08968]">
                                  <span>‚ù§Ô∏è</span>
                                  <span>{material.favorites_count}</span>
                                </span>
                              )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                    
                    {/* –ö–Ω–æ–ø–∫–∏ "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë" / "–°–∫—Ä—ã—Ç—å" */}
                    {filteredMaterials.length > ITEMS_PER_PAGE && (
                      <div className="flex justify-center gap-3 mt-6">
                        {visibleCount < filteredMaterials.length && (
                          <button
                            onClick={() => setVisibleCount(prev => prev + ITEMS_PER_PAGE)}
                            className="px-6 py-3 bg-gradient-to-r from-[#B08968] to-[#A67C52] text-white font-medium rounded-xl shadow-lg shadow-[#B08968]/25 hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300"
                          >
                            –ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë ({Math.min(ITEMS_PER_PAGE, filteredMaterials.length - visibleCount)})
                          </button>
                        )}
                        {visibleCount > ITEMS_PER_PAGE && (
                          <button
                            onClick={() => setVisibleCount(ITEMS_PER_PAGE)}
                            className="px-6 py-3 bg-white/90 text-[#5C5650] font-medium rounded-xl border border-[#E8D4BA]/40 hover:bg-[#F5E6D3] hover:-translate-y-0.5 transition-all duration-300"
                          >
                            –°–∫—Ä—ã—Ç—å
                          </button>
                        )}
                      </div>
                    )}
                  </>
                )}
              </>
            )
          })()}
        </section>

        {/* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ API */}
        {apiCategories.length > 0 && (
          <section className="mb-12">
            <h3 className="text-2xl font-bold text-[#2D2A26] mb-6">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
            
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              {apiCategories.map((cat) => (
                <button 
                  key={cat.id}
                  onClick={() => setActiveCategory(cat.slug)}
                  className={`group bg-white/90 rounded-2xl p-6 text-center shadow-lg shadow-[#C9A882]/10 hover:shadow-xl hover:shadow-[#C9A882]/20 transition-all duration-300 cursor-pointer border hover:-translate-y-1 ${
                    activeCategory === cat.slug 
                      ? 'border-[#B08968] bg-[#F5E6D3]/50' 
                      : 'border-[#E8D4BA]/40'
                  }`}
                >
                  <div className="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">{cat.icon}</div>
                  <div className="font-semibold text-[#2D2A26]">{cat.name}</div>
                  <div className="text-sm text-[#8B8279] mt-2">
                    {cat.materials_count || 0} –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                  </div>
                </button>
              ))}
            </div>
          </section>
        )}

      </main>

      {/* Mobile Navigation - Floating Glass —Å –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π */}
      <nav className={`md:hidden fixed bottom-6 left-4 right-4 z-50 transition-all duration-300 ease-in-out ${showMobileNav ? 'translate-y-0 opacity-100' : 'translate-y-24 opacity-0'}`}>
        <div className="flex items-center justify-around rounded-2xl px-2 py-3 shadow-2xl border border-white/50" style={{ background: 'rgba(255,255,255,0.45)', backdropFilter: 'blur(24px) saturate(180%)' }}>
          {isPWA && (
            <button 
              onClick={() => window.location.reload()} 
              className="p-2.5 rounded-xl text-[#B08968] hover:bg-[#F5E6D3] transition-colors"
              title="–û–±–Ω–æ–≤–∏—Ç—å"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
                <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
                <path d="M21 21v-5h-5"/>
              </svg>
            </button>
          )}
          <a href="/library" className="px-4 py-2 rounded-xl text-sm font-semibold bg-[#B08968] text-white shadow-md">
            –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞
          </a>
          <a href="/favorites" className="px-4 py-2 rounded-xl text-sm font-medium text-[#8B8279]">
            –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
          </a>
          <a href="/history" className="px-4 py-2 rounded-xl text-sm font-medium text-[#8B8279]">
            –ò—Å—Ç–æ—Ä–∏—è
          </a>
        </div>
      </nav>
    </div>
  )
}
